#include <criterion/criterion.h>

#ifndef V8SI_OPER_C
#define V8SI_OPER_C
#include "src/v8si_operation.c"
#endif

// ==== TESTS FOR THE OPERATION MODULE OF MATRIX ==== //

#define check_value(val, expect) \
    cr_expect(val == expect, "Wrong value - Expect %d, got %d.", expect, val)

#define check_value_at(val, expect, i, j) \
    cr_expect(val == expect, "Wrong value at (%d,%d) - Expect %d, got %d.", i, j, expect, val)

static mx_chunk_t sample = {
    .i32_16x16 = {
        {  0,   1,   2,   3,   4,   5,   6,   7,   8,   9,  10,  11,  12,  13,  14,  15},
        { 16,  17,  18,  19,  20,  21,  22,  23,  24,  25,  26,  27,  28,  29,  30,  31},
        { 32,  33,  34,  35,  36,  37,  38,  39,  40,  41,  42,  43,  44,  45,  46,  47},
        { 48,  49,  50,  51,  52,  53,  54,  55,  56,  57,  58,  59,  60,  61,  62,  63},
        { 64,  65,  66,  67,  68,  69,  70,  71,  72,  73,  74,  75,  76,  77,  78,  79},
        { 80,  81,  82,  83,  84,  85,  86,  87,  88,  89,  90,  91,  92,  93,  94,  95},
        { 96,  97,  98,  99, 100, 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111},
        {112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 123, 124, 125, 126, 127},
        {128, 129, 130, 131, 132, 133, 134, 135, 136, 137, 138, 139, 140, 141, 142, 143},
        {144, 145, 146, 147, 148, 149, 150, 151, 152, 153, 154, 155, 156, 157, 158, 159},
        {160, 161, 162, 163, 164, 165, 166, 167, 168, 169, 170, 171, 172, 173, 174, 175},
        {176, 177, 178, 179, 180, 181, 182, 183, 184, 185, 186, 187, 188, 189, 190, 191},
        {192, 193, 194, 195, 196, 197, 198, 199, 200, 201, 202, 203, 204, 205, 206, 207},
        {208, 209, 210, 211, 212, 213, 214, 215, 216, 217, 218, 219, 220, 221, 222, 223},
        {224, 225, 226, 227, 228, 229, 230, 231, 232, 233, 234, 235, 236, 237, 238, 239},
        {240, 241, 242, 243, 244, 245, 246, 247, 248, 249, 250, 251, 252, 253, 254, 255},
    }
};

Test(InternalFunc, v8si_add_chunk_fully)
{
    mx_chunk_t dst;
    uint32_t i = 0;
    uint32_t j = 0;
    
    // -- 16x16 chunk -- //
    {
        mx_chunk_t src = {
            .v8si_16x2 = {
                {{  0,   1,   2,   3,   4,   5,   6,   7}, {  8,   9,  10,  11,  12,  13,  14,  15}},
                {{ 16,  17,  18,  19,  20,  21,  22,  23}, { 24,  25,  26,  27,  28,  29,  30,  31}},
                {{ 32,  33,  34,  35,  36,  37,  38,  39}, { 40,  41,  42,  43,  44,  45,  46,  47}},
                {{ 48,  49,  50,  51,  52,  53,  54,  55}, { 56,  57,  58,  59,  60,  61,  62,  63}},
                {{ 64,  65,  66,  67,  68,  69,  70,  71}, { 72,  73,  74,  75,  76,  77,  78,  79}},
                {{ 80,  81,  82,  83,  84,  85,  86,  87}, { 88,  89,  90,  91,  92,  93,  94,  95}},
                {{ 96,  97,  98,  99, 100, 101, 102, 103}, {104, 105, 106, 107, 108, 109, 110, 111}},
                {{112, 113, 114, 115, 116, 117, 118, 119}, {120, 121, 122, 123, 124, 125, 126, 127}},
                {{128, 129, 130, 131, 132, 133, 134, 135}, {136, 137, 138, 139, 140, 141, 142, 143}},
                {{144, 145, 146, 147, 148, 149, 150, 151}, {152, 153, 154, 155, 156, 157, 158, 159}},
                {{160, 161, 162, 163, 164, 165, 166, 167}, {168, 169, 170, 171, 172, 173, 174, 175}},
                {{176, 177, 178, 179, 180, 181, 182, 183}, {184, 185, 186, 187, 188, 189, 190, 191}},
                {{192, 193, 194, 195, 196, 197, 198, 199}, {200, 201, 202, 203, 204, 205, 206, 207}},
                {{208, 209, 210, 211, 212, 213, 214, 215}, {216, 217, 218, 219, 220, 221, 222, 223}},
                {{224, 225, 226, 227, 228, 229, 230, 231}, {232, 233, 234, 235, 236, 237, 238, 239}},
                {{240, 241, 242, 243, 244, 245, 246, 247}, {248, 249, 250, 251, 252, 253, 254, 255}},
            }
        };
        memset(&dst, 0, sizeof(dst));

        v8si_add_chunk_fully(&dst, &src, &src);
        for (i = 0; i < 16; i += 1) {
            for (j = 0; j < 2; j += 1) {
                check_value_at(dst.v8si_16x2[i][j][0], src.v8si_16x2[i][j][0] * 2, i, j * 8 + 0);
                check_value_at(dst.v8si_16x2[i][j][1], src.v8si_16x2[i][j][1] * 2, i, j * 8 + 1);
                check_value_at(dst.v8si_16x2[i][j][2], src.v8si_16x2[i][j][2] * 2, i, j * 8 + 2);
                check_value_at(dst.v8si_16x2[i][j][3], src.v8si_16x2[i][j][3] * 2, i, j * 8 + 3);
                check_value_at(dst.v8si_16x2[i][j][4], src.v8si_16x2[i][j][4] * 2, i, j * 8 + 4);
                check_value_at(dst.v8si_16x2[i][j][5], src.v8si_16x2[i][j][5] * 2, i, j * 8 + 5);
                check_value_at(dst.v8si_16x2[i][j][6], src.v8si_16x2[i][j][6] * 2, i, j * 8 + 6);
                check_value_at(dst.v8si_16x2[i][j][7], src.v8si_16x2[i][j][7] * 2, i, j * 8 + 7);
            } // for
        } // for
    }
}

Test(InternalFunc, v8si_add_chunk_partly)
{
    mx_chunk_t dst;
    uint32_t i = 0;
    uint32_t j = 0;

    // -- 1x1 chunk -- //
    {
        mx_chunk_t src = {
            .v8si_16x1 = {
                {{0, 0, 0, 0, 0, 0, 0, 0}},
            }
        };
        memset(&dst, 0, sizeof(dst));

        v8si_add_chunk_partly(&dst, &src, &src, 1, 1);
        check_value_at(dst.v8si_16x1[0][0][0], src.v8si_16x1[0][0][0] * 2, 0, 0 * 8 + 0);
    }

    // -- 5x5 chunk -- //
    {
        mx_chunk_t src = {
            .v8si_16x1 = {
                {{ 0,  1,  2,  3,  4, 0, 0, 0}},
                {{16, 17, 18, 19, 20, 0, 0, 0}},
                {{32, 33, 34, 35, 36, 0, 0, 0}},
                {{48, 49, 50, 51, 52, 0, 0, 0}},
                {{64, 65, 66, 67, 68, 0, 0, 0}},
            }
        };
        memset(&dst, 0, sizeof(dst));

        v8si_add_chunk_partly(&dst, &src, &src, 5, 5);
        for (i = 0; i < 5; i += 1) {
            check_value_at(dst.v8si_16x1[0][0][0], src.v8si_16x1[0][0][0] * 2, 0, 0 * 8 + 0);
            check_value_at(dst.v8si_16x1[0][0][1], src.v8si_16x1[0][0][1] * 2, 0, 0 * 8 + 1);
            check_value_at(dst.v8si_16x1[0][0][2], src.v8si_16x1[0][0][2] * 2, 0, 0 * 8 + 2);
            check_value_at(dst.v8si_16x1[0][0][3], src.v8si_16x1[0][0][3] * 2, 0, 0 * 8 + 3);
            check_value_at(dst.v8si_16x1[0][0][4], src.v8si_16x1[0][0][4] * 2, 0, 0 * 8 + 4);
        } // for
    }

    // -- 8x8 chunk -- //
    {
        mx_chunk_t src = {
            .v8si_16x1 = {
                {{  0,   1,   2,   3,   4,   5,   6,   7}},
                {{ 16,  17,  18,  19,  20,  21,  22,  23}},
                {{ 32,  33,  34,  35,  36,  37,  38,  39}},
                {{ 48,  49,  50,  51,  52,  53,  54,  55}},
                {{ 64,  65,  66,  67,  68,  69,  70,  71}},
                {{ 80,  81,  82,  83,  84,  85,  86,  87}},
                {{ 96,  97,  98,  99, 100, 101, 102, 103}},
                {{112, 113, 114, 115, 116, 117, 118, 119}},
            }
        };
        memset(&dst, 0, sizeof(dst));

        v8si_add_chunk_partly(&dst, &src, &src, 8, 8);
        for (i = 0; i < 8; i += 1) {
            check_value_at(dst.v8si_16x1[0][0][0], src.v8si_16x1[0][0][0] * 2, 0, 0 * 8 + 0);
            check_value_at(dst.v8si_16x1[0][0][1], src.v8si_16x1[0][0][1] * 2, 0, 0 * 8 + 1);
            check_value_at(dst.v8si_16x1[0][0][2], src.v8si_16x1[0][0][2] * 2, 0, 0 * 8 + 2);
            check_value_at(dst.v8si_16x1[0][0][3], src.v8si_16x1[0][0][3] * 2, 0, 0 * 8 + 3);
            check_value_at(dst.v8si_16x1[0][0][4], src.v8si_16x1[0][0][4] * 2, 0, 0 * 8 + 4);
            check_value_at(dst.v8si_16x1[0][0][5], src.v8si_16x1[0][0][5] * 2, 0, 0 * 8 + 5);
            check_value_at(dst.v8si_16x1[0][0][6], src.v8si_16x1[0][0][6] * 2, 0, 0 * 8 + 6);
            check_value_at(dst.v8si_16x1[0][0][7], src.v8si_16x1[0][0][7] * 2, 0, 0 * 8 + 7);
        } // for
    }

    // -- 9x9 chunk -- //
    {
        mx_chunk_t src = {
            .v8si_16x2 = {
                {{  0,   1,   2,   3,   4,   5,   6,   7}, {  8, 0, 0, 0, 0, 0, 0, 0}},
                {{ 16,  17,  18,  19,  20,  21,  22,  23}, { 24, 0, 0, 0, 0, 0, 0, 0}},
                {{ 32,  33,  34,  35,  36,  37,  38,  39}, { 40, 0, 0, 0, 0, 0, 0, 0}},
                {{ 48,  49,  50,  51,  52,  53,  54,  55}, { 56, 0, 0, 0, 0, 0, 0, 0}},
                {{ 64,  65,  66,  67,  68,  69,  70,  71}, { 72, 0, 0, 0, 0, 0, 0, 0}},
                {{ 80,  81,  82,  83,  84,  85,  86,  87}, { 88, 0, 0, 0, 0, 0, 0, 0}},
                {{ 96,  97,  98,  99, 100, 101, 102, 103}, {104, 0, 0, 0, 0, 0, 0, 0}},
                {{112, 113, 114, 115, 116, 117, 118, 119}, {120, 0, 0, 0, 0, 0, 0, 0}},
                {{128, 129, 130, 131, 132, 133, 134, 135}, {136, 0, 0, 0, 0, 0, 0, 0}},
            }
        };
        memset(&dst, 0, sizeof(dst));

        v8si_add_chunk_partly(&dst, &src, &src, 9, 9);
        for (i = 0; i < 9; i += 1) {
            check_value_at(dst.v8si_16x2[0][0][0], src.v8si_16x2[0][0][0] * 2, 0, 0 * 8 + 0);
            check_value_at(dst.v8si_16x2[0][0][1], src.v8si_16x2[0][0][1] * 2, 0, 0 * 8 + 1);
            check_value_at(dst.v8si_16x2[0][0][2], src.v8si_16x2[0][0][2] * 2, 0, 0 * 8 + 2);
            check_value_at(dst.v8si_16x2[0][0][3], src.v8si_16x2[0][0][3] * 2, 0, 0 * 8 + 3);
            check_value_at(dst.v8si_16x2[0][0][4], src.v8si_16x2[0][0][4] * 2, 0, 0 * 8 + 4);
            check_value_at(dst.v8si_16x2[0][0][5], src.v8si_16x2[0][0][5] * 2, 0, 0 * 8 + 5);
            check_value_at(dst.v8si_16x2[0][0][6], src.v8si_16x2[0][0][6] * 2, 0, 0 * 8 + 6);
            check_value_at(dst.v8si_16x2[0][0][7], src.v8si_16x2[0][0][7] * 2, 0, 0 * 8 + 7);

            check_value_at(dst.v8si_16x2[0][1][0], src.v8si_16x2[0][1][0] * 2, 0, 1 * 8 + 0);
        } // for
    }
    
    // -- 16x16 chunk -- //
    {
        mx_chunk_t src = {
            .v8si_16x2 = {
                {{  0,   1,   2,   3,   4,   5,   6,   7}, {  8,   9,  10,  11,  12,  13,  14,  15}},
                {{ 16,  17,  18,  19,  20,  21,  22,  23}, { 24,  25,  26,  27,  28,  29,  30,  31}},
                {{ 32,  33,  34,  35,  36,  37,  38,  39}, { 40,  41,  42,  43,  44,  45,  46,  47}},
                {{ 48,  49,  50,  51,  52,  53,  54,  55}, { 56,  57,  58,  59,  60,  61,  62,  63}},
                {{ 64,  65,  66,  67,  68,  69,  70,  71}, { 72,  73,  74,  75,  76,  77,  78,  79}},
                {{ 80,  81,  82,  83,  84,  85,  86,  87}, { 88,  89,  90,  91,  92,  93,  94,  95}},
                {{ 96,  97,  98,  99, 100, 101, 102, 103}, {104, 105, 106, 107, 108, 109, 110, 111}},
                {{112, 113, 114, 115, 116, 117, 118, 119}, {120, 121, 122, 123, 124, 125, 126, 127}},
                {{128, 129, 130, 131, 132, 133, 134, 135}, {136, 137, 138, 139, 140, 141, 142, 143}},
                {{144, 145, 146, 147, 148, 149, 150, 151}, {152, 153, 154, 155, 156, 157, 158, 159}},
                {{160, 161, 162, 163, 164, 165, 166, 167}, {168, 169, 170, 171, 172, 173, 174, 175}},
                {{176, 177, 178, 179, 180, 181, 182, 183}, {184, 185, 186, 187, 188, 189, 190, 191}},
                {{192, 193, 194, 195, 196, 197, 198, 199}, {200, 201, 202, 203, 204, 205, 206, 207}},
                {{208, 209, 210, 211, 212, 213, 214, 215}, {216, 217, 218, 219, 220, 221, 222, 223}},
                {{224, 225, 226, 227, 228, 229, 230, 231}, {232, 233, 234, 235, 236, 237, 238, 239}},
                {{240, 241, 242, 243, 244, 245, 246, 247}, {248, 249, 250, 251, 252, 253, 254, 255}},
            }
        };
        memset(&dst, 0, sizeof(dst));

        v8si_add_chunk_partly(&dst, &src, &src, 16, 16);
        for (i = 0; i < 16; i += 1) {
            for (j = 0; j < 2; j += 1) {
                check_value_at(dst.v8si_16x2[i][j][0], src.v8si_16x2[i][j][0] * 2, i, j * 8 + 0);
                check_value_at(dst.v8si_16x2[i][j][1], src.v8si_16x2[i][j][1] * 2, i, j * 8 + 1);
                check_value_at(dst.v8si_16x2[i][j][2], src.v8si_16x2[i][j][2] * 2, i, j * 8 + 2);
                check_value_at(dst.v8si_16x2[i][j][3], src.v8si_16x2[i][j][3] * 2, i, j * 8 + 3);
                check_value_at(dst.v8si_16x2[i][j][4], src.v8si_16x2[i][j][4] * 2, i, j * 8 + 4);
                check_value_at(dst.v8si_16x2[i][j][5], src.v8si_16x2[i][j][5] * 2, i, j * 8 + 5);
                check_value_at(dst.v8si_16x2[i][j][6], src.v8si_16x2[i][j][6] * 2, i, j * 8 + 6);
                check_value_at(dst.v8si_16x2[i][j][7], src.v8si_16x2[i][j][7] * 2, i, j * 8 + 7);
            } // for
        } // for
    }

    // -- 1x5 chunk -- //
    {
        mx_chunk_t src = {
            .v8si_16x1 = {
                {{ 0,  1,  2,  3,  4, 0, 0, 0}},
            }
        };
        memset(&dst, 0, sizeof(dst));

        v8si_add_chunk_partly(&dst, &src, &src, 1, 5);
        check_value_at(dst.v8si_16x1[0][0][0], src.v8si_16x1[0][0][0] * 2, 0, 0 * 8 + 0);
        check_value_at(dst.v8si_16x1[0][0][1], src.v8si_16x1[0][0][1] * 2, 0, 0 * 8 + 1);
        check_value_at(dst.v8si_16x1[0][0][2], src.v8si_16x1[0][0][2] * 2, 0, 0 * 8 + 2);
        check_value_at(dst.v8si_16x1[0][0][3], src.v8si_16x1[0][0][3] * 2, 0, 0 * 8 + 3);
        check_value_at(dst.v8si_16x1[0][0][4], src.v8si_16x1[0][0][4] * 2, 0, 0 * 8 + 4);
    }

    // -- 1x8 chunk -- //
    {
        mx_chunk_t src = {
            .v8si_16x1 = {
                {{0, 1, 2, 3, 4, 5, 6, 7}},
            }
        };
        memset(&dst, 0, sizeof(dst));

        v8si_add_chunk_partly(&dst, &src, &src, 1, 8);
        check_value_at(dst.v8si_16x1[0][0][0], src.v8si_16x1[0][0][0] * 2, 0, 0 * 8 + 0);
        check_value_at(dst.v8si_16x1[0][0][1], src.v8si_16x1[0][0][1] * 2, 0, 0 * 8 + 1);
        check_value_at(dst.v8si_16x1[0][0][2], src.v8si_16x1[0][0][2] * 2, 0, 0 * 8 + 2);
        check_value_at(dst.v8si_16x1[0][0][3], src.v8si_16x1[0][0][3] * 2, 0, 0 * 8 + 3);
        check_value_at(dst.v8si_16x1[0][0][4], src.v8si_16x1[0][0][4] * 2, 0, 0 * 8 + 4);
        check_value_at(dst.v8si_16x1[0][0][5], src.v8si_16x1[0][0][5] * 2, 0, 0 * 8 + 5);
        check_value_at(dst.v8si_16x1[0][0][6], src.v8si_16x1[0][0][6] * 2, 0, 0 * 8 + 6);
        check_value_at(dst.v8si_16x1[0][0][7], src.v8si_16x1[0][0][7] * 2, 0, 0 * 8 + 7);
    }

    // -- 1x9 chunk -- //
    {
        mx_chunk_t src = {
            .v8si_16x2 = {
                {{0, 1, 2, 3, 4, 5, 6, 7}, {8, 0, 0, 0, 0, 0, 0, 0}},
            }
        };
        memset(&dst, 0, sizeof(dst));

        v8si_add_chunk_partly(&dst, &src, &src, 1, 9);
        check_value_at(dst.v8si_16x2[0][0][0], src.v8si_16x2[0][0][0] * 2, 0, 0 * 8 + 0);
        check_value_at(dst.v8si_16x2[0][0][1], src.v8si_16x2[0][0][1] * 2, 0, 0 * 8 + 1);
        check_value_at(dst.v8si_16x2[0][0][2], src.v8si_16x2[0][0][2] * 2, 0, 0 * 8 + 2);
        check_value_at(dst.v8si_16x2[0][0][3], src.v8si_16x2[0][0][3] * 2, 0, 0 * 8 + 3);
        check_value_at(dst.v8si_16x2[0][0][4], src.v8si_16x2[0][0][4] * 2, 0, 0 * 8 + 4);
        check_value_at(dst.v8si_16x2[0][0][5], src.v8si_16x2[0][0][5] * 2, 0, 0 * 8 + 5);
        check_value_at(dst.v8si_16x2[0][0][6], src.v8si_16x2[0][0][6] * 2, 0, 0 * 8 + 6);
        check_value_at(dst.v8si_16x2[0][0][7], src.v8si_16x2[0][0][7] * 2, 0, 0 * 8 + 7);

        check_value_at(dst.v8si_16x2[0][1][0], src.v8si_16x2[0][1][0] * 2, 0, 1 * 8 + 0);
    }

    // -- 5x1 chunk -- //
    {
        mx_chunk_t src = {
            .v8si_16x1 = {
                {{  0, 0, 0, 0, 0, 0, 0, 0}},
                {{ 16, 0, 0, 0, 0, 0, 0, 0}},
                {{ 32, 0, 0, 0, 0, 0, 0, 0}},
                {{ 48, 0, 0, 0, 0, 0, 0, 0}},
                {{ 64, 0, 0, 0, 0, 0, 0, 0}},
            }
        };
        memset(&dst, 0, sizeof(dst));

        v8si_add_chunk_partly(&dst, &src, &src, 5, 1);
        check_value_at(dst.v8si_16x1[0][0][0], src.v8si_16x1[0][0][0] * 2, 0, 0 * 8 + 0);
        check_value_at(dst.v8si_16x1[1][0][0], src.v8si_16x1[1][0][0] * 2, 1, 0 * 8 + 1);
        check_value_at(dst.v8si_16x1[2][0][0], src.v8si_16x1[2][0][0] * 2, 2, 0 * 8 + 2);
        check_value_at(dst.v8si_16x1[3][0][0], src.v8si_16x1[3][0][0] * 2, 3, 0 * 8 + 3);
        check_value_at(dst.v8si_16x1[4][0][0], src.v8si_16x1[4][0][0] * 2, 4, 0 * 8 + 4);
    }

    // -- 8x1 chunk -- //
    {
        mx_chunk_t src = {
            .v8si_16x1 = {
                {{  0, 0, 0, 0, 0, 0, 0, 0}},
                {{ 16, 0, 0, 0, 0, 0, 0, 0}},
                {{ 32, 0, 0, 0, 0, 0, 0, 0}},
                {{ 48, 0, 0, 0, 0, 0, 0, 0}},
                {{ 64, 0, 0, 0, 0, 0, 0, 0}},
                {{ 80, 0, 0, 0, 0, 0, 0, 0}},
                {{ 96, 0, 0, 0, 0, 0, 0, 0}},
                {{112, 0, 0, 0, 0, 0, 0, 0}},
            }
        };
        memset(&dst, 0, sizeof(dst));

        v8si_add_chunk_partly(&dst, &src, &src, 8, 1);
        check_value_at(dst.v8si_16x1[0][0][0], src.v8si_16x1[0][0][0] * 2, 0, 0 * 8 + 0);
        check_value_at(dst.v8si_16x1[1][0][0], src.v8si_16x1[1][0][0] * 2, 1, 0 * 8 + 1);
        check_value_at(dst.v8si_16x1[2][0][0], src.v8si_16x1[2][0][0] * 2, 2, 0 * 8 + 2);
        check_value_at(dst.v8si_16x1[3][0][0], src.v8si_16x1[3][0][0] * 2, 3, 0 * 8 + 3);
        check_value_at(dst.v8si_16x1[4][0][0], src.v8si_16x1[4][0][0] * 2, 4, 0 * 8 + 4);
        check_value_at(dst.v8si_16x1[5][0][0], src.v8si_16x1[5][0][0] * 2, 5, 0 * 8 + 5);
        check_value_at(dst.v8si_16x1[6][0][0], src.v8si_16x1[6][0][0] * 2, 6, 0 * 8 + 6);
        check_value_at(dst.v8si_16x1[7][0][0], src.v8si_16x1[7][0][0] * 2, 7, 0 * 8 + 7);
    }

    // -- 9x1 chunk -- //
    {
        mx_chunk_t src = {
            .v8si_16x1 = {
                {{  0, 0, 0, 0, 0, 0, 0, 0}},
                {{ 16, 0, 0, 0, 0, 0, 0, 0}},
                {{ 32, 0, 0, 0, 0, 0, 0, 0}},
                {{ 48, 0, 0, 0, 0, 0, 0, 0}},
                {{ 64, 0, 0, 0, 0, 0, 0, 0}},
                {{ 80, 0, 0, 0, 0, 0, 0, 0}},
                {{ 96, 0, 0, 0, 0, 0, 0, 0}},
                {{112, 0, 0, 0, 0, 0, 0, 0}},
                {{128, 0, 0, 0, 0, 0, 0, 0}},
            }
        };
        memset(&dst, 0, sizeof(dst));

        v8si_add_chunk_partly(&dst, &src, &src, 9, 1);
        check_value_at(dst.v8si_16x1[0][0][0], src.v8si_16x1[0][0][0] * 2, 0, 0 * 8 + 0);
        check_value_at(dst.v8si_16x1[1][0][0], src.v8si_16x1[1][0][0] * 2, 1, 0 * 8 + 1);
        check_value_at(dst.v8si_16x1[2][0][0], src.v8si_16x1[2][0][0] * 2, 2, 0 * 8 + 2);
        check_value_at(dst.v8si_16x1[3][0][0], src.v8si_16x1[3][0][0] * 2, 3, 0 * 8 + 3);
        check_value_at(dst.v8si_16x1[4][0][0], src.v8si_16x1[4][0][0] * 2, 4, 0 * 8 + 4);
        check_value_at(dst.v8si_16x1[5][0][0], src.v8si_16x1[5][0][0] * 2, 5, 0 * 8 + 5);
        check_value_at(dst.v8si_16x1[6][0][0], src.v8si_16x1[6][0][0] * 2, 6, 0 * 8 + 6);
        check_value_at(dst.v8si_16x1[7][0][0], src.v8si_16x1[7][0][0] * 2, 7, 0 * 8 + 7);
        check_value_at(dst.v8si_16x1[8][1][0], src.v8si_16x1[8][1][0] * 2, 8, 1 * 8 + 0);
    }
}

Test(InternalFunc, v8si_subtract_chunk_fully)
{
    mx_chunk_t dst;
    uint32_t i = 0;
    uint32_t j = 0;
    
    // -- 16x16 chunk -- //
    {
        mx_chunk_t src = {
            .v8si_16x2 = {
                {{  0,   1,   2,   3,   4,   5,   6,   7}, {  8,   9,  10,  11,  12,  13,  14,  15}},
                {{ 16,  17,  18,  19,  20,  21,  22,  23}, { 24,  25,  26,  27,  28,  29,  30,  31}},
                {{ 32,  33,  34,  35,  36,  37,  38,  39}, { 40,  41,  42,  43,  44,  45,  46,  47}},
                {{ 48,  49,  50,  51,  52,  53,  54,  55}, { 56,  57,  58,  59,  60,  61,  62,  63}},
                {{ 64,  65,  66,  67,  68,  69,  70,  71}, { 72,  73,  74,  75,  76,  77,  78,  79}},
                {{ 80,  81,  82,  83,  84,  85,  86,  87}, { 88,  89,  90,  91,  92,  93,  94,  95}},
                {{ 96,  97,  98,  99, 100, 101, 102, 103}, {104, 105, 106, 107, 108, 109, 110, 111}},
                {{112, 113, 114, 115, 116, 117, 118, 119}, {120, 121, 122, 123, 124, 125, 126, 127}},
                {{128, 129, 130, 131, 132, 133, 134, 135}, {136, 137, 138, 139, 140, 141, 142, 143}},
                {{144, 145, 146, 147, 148, 149, 150, 151}, {152, 153, 154, 155, 156, 157, 158, 159}},
                {{160, 161, 162, 163, 164, 165, 166, 167}, {168, 169, 170, 171, 172, 173, 174, 175}},
                {{176, 177, 178, 179, 180, 181, 182, 183}, {184, 185, 186, 187, 188, 189, 190, 191}},
                {{192, 193, 194, 195, 196, 197, 198, 199}, {200, 201, 202, 203, 204, 205, 206, 207}},
                {{208, 209, 210, 211, 212, 213, 214, 215}, {216, 217, 218, 219, 220, 221, 222, 223}},
                {{224, 225, 226, 227, 228, 229, 230, 231}, {232, 233, 234, 235, 236, 237, 238, 239}},
                {{240, 241, 242, 243, 244, 245, 246, 247}, {248, 249, 250, 251, 252, 253, 254, 255}},
            }
        };
        memset(&dst, 0, sizeof(dst));

        v8si_subtract_chunk_fully(&dst, &src, &src);
        for (i = 0; i < 16; i += 1) {
            for (j = 0; j < 2; j += 1) {
                check_value_at(dst.v8si_16x2[i][j][0], 0, i, j * 8 + 0);
                check_value_at(dst.v8si_16x2[i][j][1], 0, i, j * 8 + 1);
                check_value_at(dst.v8si_16x2[i][j][2], 0, i, j * 8 + 2);
                check_value_at(dst.v8si_16x2[i][j][3], 0, i, j * 8 + 3);
                check_value_at(dst.v8si_16x2[i][j][4], 0, i, j * 8 + 4);
                check_value_at(dst.v8si_16x2[i][j][5], 0, i, j * 8 + 5);
                check_value_at(dst.v8si_16x2[i][j][6], 0, i, j * 8 + 6);
                check_value_at(dst.v8si_16x2[i][j][7], 0, i, j * 8 + 7);
            } // for
        } // for
    }
}

Test(InternalFunc, v8si_subtract_chunk_partly)
{
    mx_chunk_t dst;
    uint32_t i = 0;
    uint32_t j = 0;

    // -- 1x1 chunk -- //
    {
        mx_chunk_t src = {
            .v8si_16x1 = {
                {{0, 0, 0, 0, 0, 0, 0, 0}},
            }
        };
        memset(&dst, 0, sizeof(dst));

        v8si_subtract_chunk_partly(&dst, &src, &src, 1, 1);
        check_value_at(dst.v8si_16x1[0][0][0], 0, 0, 0 * 8 + 0);
    }

    // -- 5x5 chunk -- //
    {
        mx_chunk_t src = {
            .v8si_16x1 = {
                {{ 0,  1,  2,  3,  4, 0, 0, 0}},
                {{16, 17, 18, 19, 20, 0, 0, 0}},
                {{32, 33, 34, 35, 36, 0, 0, 0}},
                {{48, 49, 50, 51, 52, 0, 0, 0}},
                {{64, 65, 66, 67, 68, 0, 0, 0}},
            }
        };
        memset(&dst, 0, sizeof(dst));

        v8si_subtract_chunk_partly(&dst, &src, &src, 5, 5);
        for (i = 0; i < 5; i += 1) {
            check_value_at(dst.v8si_16x1[0][0][0], 0, 0, 0 * 8 + 0);
            check_value_at(dst.v8si_16x1[0][0][1], 0, 0, 0 * 8 + 1);
            check_value_at(dst.v8si_16x1[0][0][2], 0, 0, 0 * 8 + 2);
            check_value_at(dst.v8si_16x1[0][0][3], 0, 0, 0 * 8 + 3);
            check_value_at(dst.v8si_16x1[0][0][4], 0, 0, 0 * 8 + 4);
        } // for
    }

    // -- 8x8 chunk -- //
    {
        mx_chunk_t src = {
            .v8si_16x1 = {
                {{  0,   1,   2,   3,   4,   5,   6,   7}},
                {{ 16,  17,  18,  19,  20,  21,  22,  23}},
                {{ 32,  33,  34,  35,  36,  37,  38,  39}},
                {{ 48,  49,  50,  51,  52,  53,  54,  55}},
                {{ 64,  65,  66,  67,  68,  69,  70,  71}},
                {{ 80,  81,  82,  83,  84,  85,  86,  87}},
                {{ 96,  97,  98,  99, 100, 101, 102, 103}},
                {{112, 113, 114, 115, 116, 117, 118, 119}},
            }
        };
        memset(&dst, 0, sizeof(dst));

        v8si_subtract_chunk_partly(&dst, &src, &src, 8, 8);
        for (i = 0; i < 8; i += 1) {
            check_value_at(dst.v8si_16x1[0][0][0], 0, 0, 0 * 8 + 0);
            check_value_at(dst.v8si_16x1[0][0][1], 0, 0, 0 * 8 + 1);
            check_value_at(dst.v8si_16x1[0][0][2], 0, 0, 0 * 8 + 2);
            check_value_at(dst.v8si_16x1[0][0][3], 0, 0, 0 * 8 + 3);
            check_value_at(dst.v8si_16x1[0][0][4], 0, 0, 0 * 8 + 4);
            check_value_at(dst.v8si_16x1[0][0][5], 0, 0, 0 * 8 + 5);
            check_value_at(dst.v8si_16x1[0][0][6], 0, 0, 0 * 8 + 6);
            check_value_at(dst.v8si_16x1[0][0][7], 0, 0, 0 * 8 + 7);
        } // for
    }

    // -- 9x9 chunk -- //
    {
        mx_chunk_t src = {
            .v8si_16x2 = {
                {{  0,   1,   2,   3,   4,   5,   6,   7}, {  8, 0, 0, 0, 0, 0, 0, 0}},
                {{ 16,  17,  18,  19,  20,  21,  22,  23}, { 24, 0, 0, 0, 0, 0, 0, 0}},
                {{ 32,  33,  34,  35,  36,  37,  38,  39}, { 40, 0, 0, 0, 0, 0, 0, 0}},
                {{ 48,  49,  50,  51,  52,  53,  54,  55}, { 56, 0, 0, 0, 0, 0, 0, 0}},
                {{ 64,  65,  66,  67,  68,  69,  70,  71}, { 72, 0, 0, 0, 0, 0, 0, 0}},
                {{ 80,  81,  82,  83,  84,  85,  86,  87}, { 88, 0, 0, 0, 0, 0, 0, 0}},
                {{ 96,  97,  98,  99, 100, 101, 102, 103}, {104, 0, 0, 0, 0, 0, 0, 0}},
                {{112, 113, 114, 115, 116, 117, 118, 119}, {120, 0, 0, 0, 0, 0, 0, 0}},
                {{128, 129, 130, 131, 132, 133, 134, 135}, {136, 0, 0, 0, 0, 0, 0, 0}},
            }
        };
        memset(&dst, 0, sizeof(dst));

        v8si_subtract_chunk_partly(&dst, &src, &src, 9, 9);
        for (i = 0; i < 9; i += 1) {
            check_value_at(dst.v8si_16x2[0][0][0], 0, 0, 0 * 8 + 0);
            check_value_at(dst.v8si_16x2[0][0][1], 0, 0, 0 * 8 + 1);
            check_value_at(dst.v8si_16x2[0][0][2], 0, 0, 0 * 8 + 2);
            check_value_at(dst.v8si_16x2[0][0][3], 0, 0, 0 * 8 + 3);
            check_value_at(dst.v8si_16x2[0][0][4], 0, 0, 0 * 8 + 4);
            check_value_at(dst.v8si_16x2[0][0][5], 0, 0, 0 * 8 + 5);
            check_value_at(dst.v8si_16x2[0][0][6], 0, 0, 0 * 8 + 6);
            check_value_at(dst.v8si_16x2[0][0][7], 0, 0, 0 * 8 + 7);

            check_value_at(dst.v8si_16x2[0][1][0], 0, 0, 1 * 8 + 0);
        } // for
    }
    
    // -- 16x16 chunk -- //
    {
        mx_chunk_t src = {
            .v8si_16x2 = {
                {{  0,   1,   2,   3,   4,   5,   6,   7}, {  8,   9,  10,  11,  12,  13,  14,  15}},
                {{ 16,  17,  18,  19,  20,  21,  22,  23}, { 24,  25,  26,  27,  28,  29,  30,  31}},
                {{ 32,  33,  34,  35,  36,  37,  38,  39}, { 40,  41,  42,  43,  44,  45,  46,  47}},
                {{ 48,  49,  50,  51,  52,  53,  54,  55}, { 56,  57,  58,  59,  60,  61,  62,  63}},
                {{ 64,  65,  66,  67,  68,  69,  70,  71}, { 72,  73,  74,  75,  76,  77,  78,  79}},
                {{ 80,  81,  82,  83,  84,  85,  86,  87}, { 88,  89,  90,  91,  92,  93,  94,  95}},
                {{ 96,  97,  98,  99, 100, 101, 102, 103}, {104, 105, 106, 107, 108, 109, 110, 111}},
                {{112, 113, 114, 115, 116, 117, 118, 119}, {120, 121, 122, 123, 124, 125, 126, 127}},
                {{128, 129, 130, 131, 132, 133, 134, 135}, {136, 137, 138, 139, 140, 141, 142, 143}},
                {{144, 145, 146, 147, 148, 149, 150, 151}, {152, 153, 154, 155, 156, 157, 158, 159}},
                {{160, 161, 162, 163, 164, 165, 166, 167}, {168, 169, 170, 171, 172, 173, 174, 175}},
                {{176, 177, 178, 179, 180, 181, 182, 183}, {184, 185, 186, 187, 188, 189, 190, 191}},
                {{192, 193, 194, 195, 196, 197, 198, 199}, {200, 201, 202, 203, 204, 205, 206, 207}},
                {{208, 209, 210, 211, 212, 213, 214, 215}, {216, 217, 218, 219, 220, 221, 222, 223}},
                {{224, 225, 226, 227, 228, 229, 230, 231}, {232, 233, 234, 235, 236, 237, 238, 239}},
                {{240, 241, 242, 243, 244, 245, 246, 247}, {248, 249, 250, 251, 252, 253, 254, 255}},
            }
        };
        memset(&dst, 0, sizeof(dst));

        v8si_subtract_chunk_partly(&dst, &src, &src, 16, 16);
        for (i = 0; i < 16; i += 1) {
            for (j = 0; j < 2; j += 1) {
                check_value_at(dst.v8si_16x2[i][j][0], 0, i, j * 8 + 0);
                check_value_at(dst.v8si_16x2[i][j][1], 0, i, j * 8 + 1);
                check_value_at(dst.v8si_16x2[i][j][2], 0, i, j * 8 + 2);
                check_value_at(dst.v8si_16x2[i][j][3], 0, i, j * 8 + 3);
                check_value_at(dst.v8si_16x2[i][j][4], 0, i, j * 8 + 4);
                check_value_at(dst.v8si_16x2[i][j][5], 0, i, j * 8 + 5);
                check_value_at(dst.v8si_16x2[i][j][6], 0, i, j * 8 + 6);
                check_value_at(dst.v8si_16x2[i][j][7], 0, i, j * 8 + 7);
            } // for
        } // for
    }

    // -- 1x5 chunk -- //
    {
        mx_chunk_t src = {
            .v8si_16x1 = {
                {{ 0,  1,  2,  3,  4, 0, 0, 0}},
            }
        };
        memset(&dst, 0, sizeof(dst));

        v8si_subtract_chunk_partly(&dst, &src, &src, 1, 5);
        check_value_at(dst.v8si_16x1[0][0][0], 0, 0, 0 * 8 + 0);
        check_value_at(dst.v8si_16x1[0][0][1], 0, 0, 0 * 8 + 1);
        check_value_at(dst.v8si_16x1[0][0][2], 0, 0, 0 * 8 + 2);
        check_value_at(dst.v8si_16x1[0][0][3], 0, 0, 0 * 8 + 3);
        check_value_at(dst.v8si_16x1[0][0][4], 0, 0, 0 * 8 + 4);
    }

    // -- 1x8 chunk -- //
    {
        mx_chunk_t src = {
            .v8si_16x1 = {
                {{0, 1, 2, 3, 4, 5, 6, 7}},
            }
        };
        memset(&dst, 0, sizeof(dst));

        v8si_subtract_chunk_partly(&dst, &src, &src, 1, 8);
        check_value_at(dst.v8si_16x1[0][0][0], 0, 0, 0 * 8 + 0);
        check_value_at(dst.v8si_16x1[0][0][1], 0, 0, 0 * 8 + 1);
        check_value_at(dst.v8si_16x1[0][0][2], 0, 0, 0 * 8 + 2);
        check_value_at(dst.v8si_16x1[0][0][3], 0, 0, 0 * 8 + 3);
        check_value_at(dst.v8si_16x1[0][0][4], 0, 0, 0 * 8 + 4);
        check_value_at(dst.v8si_16x1[0][0][5], 0, 0, 0 * 8 + 5);
        check_value_at(dst.v8si_16x1[0][0][6], 0, 0, 0 * 8 + 6);
        check_value_at(dst.v8si_16x1[0][0][7], 0, 0, 0 * 8 + 7);
    }

    // -- 1x9 chunk -- //
    {
        mx_chunk_t src = {
            .v8si_16x2 = {
                {{0, 1, 2, 3, 4, 5, 6, 7}, {8, 0, 0, 0, 0, 0, 0, 0}},
            }
        };
        memset(&dst, 0, sizeof(dst));

        v8si_subtract_chunk_partly(&dst, &src, &src, 1, 9);
        check_value_at(dst.v8si_16x2[0][0][0], 0, 0, 0 * 8 + 0);
        check_value_at(dst.v8si_16x2[0][0][1], 0, 0, 0 * 8 + 1);
        check_value_at(dst.v8si_16x2[0][0][2], 0, 0, 0 * 8 + 2);
        check_value_at(dst.v8si_16x2[0][0][3], 0, 0, 0 * 8 + 3);
        check_value_at(dst.v8si_16x2[0][0][4], 0, 0, 0 * 8 + 4);
        check_value_at(dst.v8si_16x2[0][0][5], 0, 0, 0 * 8 + 5);
        check_value_at(dst.v8si_16x2[0][0][6], 0, 0, 0 * 8 + 6);
        check_value_at(dst.v8si_16x2[0][0][7], 0, 0, 0 * 8 + 7);

        check_value_at(dst.v8si_16x2[0][1][0], 0, 0, 1 * 8 + 0);
    }

    // -- 5x1 chunk -- //
    {
        mx_chunk_t src = {
            .v8si_16x1 = {
                {{  0, 0, 0, 0, 0, 0, 0, 0}},
                {{ 16, 0, 0, 0, 0, 0, 0, 0}},
                {{ 32, 0, 0, 0, 0, 0, 0, 0}},
                {{ 48, 0, 0, 0, 0, 0, 0, 0}},
                {{ 64, 0, 0, 0, 0, 0, 0, 0}},
            }
        };
        memset(&dst, 0, sizeof(dst));

        v8si_subtract_chunk_partly(&dst, &src, &src, 5, 1);
        check_value_at(dst.v8si_16x1[0][0][0], 0, 0, 0 * 8 + 0);
        check_value_at(dst.v8si_16x1[1][0][0], 0, 1, 0 * 8 + 1);
        check_value_at(dst.v8si_16x1[2][0][0], 0, 2, 0 * 8 + 2);
        check_value_at(dst.v8si_16x1[3][0][0], 0, 3, 0 * 8 + 3);
        check_value_at(dst.v8si_16x1[4][0][0], 0, 4, 0 * 8 + 4);
    }

    // -- 8x1 chunk -- //
    {
        mx_chunk_t src = {
            .v8si_16x1 = {
                {{  0, 0, 0, 0, 0, 0, 0, 0}},
                {{ 16, 0, 0, 0, 0, 0, 0, 0}},
                {{ 32, 0, 0, 0, 0, 0, 0, 0}},
                {{ 48, 0, 0, 0, 0, 0, 0, 0}},
                {{ 64, 0, 0, 0, 0, 0, 0, 0}},
                {{ 80, 0, 0, 0, 0, 0, 0, 0}},
                {{ 96, 0, 0, 0, 0, 0, 0, 0}},
                {{112, 0, 0, 0, 0, 0, 0, 0}},
            }
        };
        memset(&dst, 0, sizeof(dst));

        v8si_subtract_chunk_partly(&dst, &src, &src, 8, 1);
        check_value_at(dst.v8si_16x1[0][0][0], 0, 0, 0 * 8 + 0);
        check_value_at(dst.v8si_16x1[1][0][0], 0, 1, 0 * 8 + 1);
        check_value_at(dst.v8si_16x1[2][0][0], 0, 2, 0 * 8 + 2);
        check_value_at(dst.v8si_16x1[3][0][0], 0, 3, 0 * 8 + 3);
        check_value_at(dst.v8si_16x1[4][0][0], 0, 4, 0 * 8 + 4);
        check_value_at(dst.v8si_16x1[5][0][0], 0, 5, 0 * 8 + 5);
        check_value_at(dst.v8si_16x1[6][0][0], 0, 6, 0 * 8 + 6);
        check_value_at(dst.v8si_16x1[7][0][0], 0, 7, 0 * 8 + 7);
    }

    // -- 9x1 chunk -- //
    {
        mx_chunk_t src = {
            .v8si_16x1 = {
                {{  0, 0, 0, 0, 0, 0, 0, 0}},
                {{ 16, 0, 0, 0, 0, 0, 0, 0}},
                {{ 32, 0, 0, 0, 0, 0, 0, 0}},
                {{ 48, 0, 0, 0, 0, 0, 0, 0}},
                {{ 64, 0, 0, 0, 0, 0, 0, 0}},
                {{ 80, 0, 0, 0, 0, 0, 0, 0}},
                {{ 96, 0, 0, 0, 0, 0, 0, 0}},
                {{112, 0, 0, 0, 0, 0, 0, 0}},
                {{128, 0, 0, 0, 0, 0, 0, 0}},
            }
        };
        memset(&dst, 0, sizeof(dst));

        v8si_subtract_chunk_partly(&dst, &src, &src, 9, 1);
        check_value_at(dst.v8si_16x1[0][0][0], 0, 0, 0 * 8 + 0);
        check_value_at(dst.v8si_16x1[1][0][0], 0, 1, 0 * 8 + 1);
        check_value_at(dst.v8si_16x1[2][0][0], 0, 2, 0 * 8 + 2);
        check_value_at(dst.v8si_16x1[3][0][0], 0, 3, 0 * 8 + 3);
        check_value_at(dst.v8si_16x1[4][0][0], 0, 4, 0 * 8 + 4);
        check_value_at(dst.v8si_16x1[5][0][0], 0, 5, 0 * 8 + 5);
        check_value_at(dst.v8si_16x1[6][0][0], 0, 6, 0 * 8 + 6);
        check_value_at(dst.v8si_16x1[7][0][0], 0, 7, 0 * 8 + 7);
        check_value_at(dst.v8si_16x1[8][1][0], 0, 8, 1 * 8 + 0);
    }
}

static mx_chunk_t qrcode_16x16 = {
    .i32_16x16 = {
        {2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2},
        {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
        {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
        {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
        {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
        {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
        {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
        {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
        {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
        {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
        {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
        {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
        {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
        {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
        {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
        {2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2}
    }
};

static mx_chunk_t qrcode_8x8 = {
    .i32_8x8 = {
        {2, 1, 1, 1, 1, 1, 1, 1},
        {1, 1, 1, 1, 1, 1, 1, 1},
        {1, 1, 1, 1, 1, 1, 1, 1},
        {1, 1, 1, 1, 1, 1, 1, 1},
        {1, 1, 1, 1, 1, 1, 1, 1},
        {1, 1, 1, 1, 1, 1, 1, 1},
        {1, 1, 1, 1, 1, 1, 1, 1},
        {1, 1, 1, 1, 1, 1, 1, 1},
    }
};

Test(InternalFunc, v8si_multiply_chunk_fully)
{
    mx_chunk_t ret;
    uint32_t i = 0;
    uint32_t j = 0;
    mx_oper_ptr mp = NULL;
    
    // -- 16x16 chunk -- //
    {
        int32_t ret_vals[16][16] = {
            {22, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 22},
            {18, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 18},
            {18, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 18},
            {18, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 18},
            {18, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 18},
            {18, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 18},
            {18, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 18},
            {18, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 18},
            {18, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 18},
            {18, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 18},
            {18, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 18},
            {18, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 18},
            {18, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 18},
            {18, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 18},
            {18, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 18},
            {22, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 22},
        };

        mp = mops_v8si_create();
        memset(&ret, 0, sizeof(ret));

        mp->lchk_rows = 16;
        mp->lchk_cols = 16;
        mp->rchk_rows = 16;
        mp->rchk_cols = 16;
        mp->mchk_rows = 16;
        mp->mchk_cols = 16;

        v8si_multiply_chunk_fully(&ret, &qrcode_16x16, &qrcode_16x16, mp);

        for (i = 0; i < mp->mchk_rows; i += 1) {
            for (j = 0; j < mp->mchk_cols; j += 1) {
                check_value_at(ret.i32_16x16[i][j], ret_vals[i][j], i, j);
            } // for
        } // for

        mops_v8si_destroy(mp);
    }
}

Test(InternalFunc, v8si_multiply_chunk_partly)
{
    mx_chunk_t ret;
    uint32_t i = 0;
    uint32_t j = 0;
    mx_oper_ptr mp = NULL;
    
    // -- 1x1 chunk -- //
    {
        int32_t ret_vals[16][16] = {
            {4, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
            {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
            {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
            {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
            {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
            {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
            {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
            {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
            {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
            {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
            {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
            {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
            {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
            {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
            {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
            {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
        };
        mp = mops_v8si_create();
        memset(&ret, 0, sizeof(ret));

        mp->lchk_rows = 1;
        mp->lchk_cols = 1;
        mp->rchk_rows = 1;
        mp->rchk_cols = 1;
        mp->mchk_rows = 1;
        mp->mchk_cols = 1;

        v8si_multiply_chunk_partly(&ret, &qrcode_8x8, &qrcode_16x16, mp);

        for (i = 0; i < mp->mchk_rows; i += 1) {
            for (j = 0; j < mp->mchk_cols; j += 1) {
                check_value_at(ret.i32_8x8[i][j], ret_vals[i][j], i, j);
            } // for
        } // for

        mops_v8si_destroy(mp);
    }

    // -- 5x5 chunk -- //
    {
        int32_t ret_vals[16][16] = {
            {8, 6, 6, 6, 6, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
            {6, 5, 5, 5, 5, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
            {6, 5, 5, 5, 5, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
            {6, 5, 5, 5, 5, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
            {6, 5, 5, 5, 5, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
            {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
            {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
            {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
            {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
            {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
            {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
            {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
            {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
            {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
            {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
            {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
        };
        mp = mops_v8si_create();
        memset(&ret, 0, sizeof(ret));

        mp->lchk_rows = 5;
        mp->lchk_cols = 5;
        mp->rchk_rows = 5;
        mp->rchk_cols = 5;
        mp->mchk_rows = 5;
        mp->mchk_cols = 5;

        v8si_multiply_chunk_partly(&ret, &qrcode_8x8, &qrcode_16x16, mp);

        for (i = 0; i < mp->mchk_rows; i += 1) {
            for (j = 0; j < mp->mchk_cols; j += 1) {
                check_value_at(ret.i32_8x8[i][j], ret_vals[i][j], i, j);
            } // for
        } // for

        mops_v8si_destroy(mp);
    }

    // -- 8x8 chunk -- //
    {
        int32_t ret_vals[16][16] = {
            {11, 9, 9, 9, 9, 9, 9, 9, 0, 0, 0, 0, 0, 0, 0, 0},
            { 9, 8, 8, 8, 8, 8, 8, 8, 0, 0, 0, 0, 0, 0, 0, 0},
            { 9, 8, 8, 8, 8, 8, 8, 8, 0, 0, 0, 0, 0, 0, 0, 0},
            { 9, 8, 8, 8, 8, 8, 8, 8, 0, 0, 0, 0, 0, 0, 0, 0},
            { 9, 8, 8, 8, 8, 8, 8, 8, 0, 0, 0, 0, 0, 0, 0, 0},
            { 9, 8, 8, 8, 8, 8, 8, 8, 0, 0, 0, 0, 0, 0, 0, 0},
            { 9, 8, 8, 8, 8, 8, 8, 8, 0, 0, 0, 0, 0, 0, 0, 0},
            { 9, 8, 8, 8, 8, 8, 8, 8, 0, 0, 0, 0, 0, 0, 0, 0},
            { 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
            { 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
            { 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
            { 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
            { 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
            { 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
            { 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
            { 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
        };
        mp = mops_v8si_create();
        memset(&ret, 0, sizeof(ret));

        mp->lchk_rows = 8;
        mp->lchk_cols = 8;
        mp->rchk_rows = 8;
        mp->rchk_cols = 8;
        mp->mchk_rows = 8;
        mp->mchk_cols = 8;

        v8si_multiply_chunk_partly(&ret, &qrcode_8x8, &qrcode_16x16, mp);

        for (i = 0; i < mp->mchk_rows; i += 1) {
            for (j = 0; j < mp->mchk_cols; j += 1) {
                check_value_at(ret.i32_8x8[i][j], ret_vals[i][j], i, j);
            } // for
        } // for

        mops_v8si_destroy(mp);
    }

    // -- 9x9 chunk -- //
    {
        int32_t ret_vals[16][16] = {
            {12, 10, 10, 10, 10, 10, 10, 10, 10,  0,  0,  0,  0,  0,  0,  0},
            {10,  9,  9,  9,  9,  9,  9,  9,  9,  0,  0,  0,  0,  0,  0,  0},
            {10,  9,  9,  9,  9,  9,  9,  9,  9,  0,  0,  0,  0,  0,  0,  0},
            {10,  9,  9,  9,  9,  9,  9,  9,  9,  0,  0,  0,  0,  0,  0,  0},
            {10,  9,  9,  9,  9,  9,  9,  9,  9,  0,  0,  0,  0,  0,  0,  0},
            {10,  9,  9,  9,  9,  9,  9,  9,  9,  0,  0,  0,  0,  0,  0,  0},
            {10,  9,  9,  9,  9,  9,  9,  9,  9,  0,  0,  0,  0,  0,  0,  0},
            {10,  9,  9,  9,  9,  9,  9,  9,  9,  0,  0,  0,  0,  0,  0,  0},
            {10,  9,  9,  9,  9,  9,  9,  9,  9,  0,  0,  0,  0,  0,  0,  0},
            { 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},
            { 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},
            { 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},
            { 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},
            { 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},
            { 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},
            { 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},
        };
        mp = mops_v8si_create();
        memset(&ret, 0, sizeof(ret));

        mp->lchk_rows = 9;
        mp->lchk_cols = 9;
        mp->rchk_rows = 9;
        mp->rchk_cols = 9;
        mp->mchk_rows = 9;
        mp->mchk_cols = 9;

        v8si_multiply_chunk_partly(&ret, &qrcode_16x16, &qrcode_16x16, mp);

        for (i = 0; i < mp->mchk_rows; i += 1) {
            for (j = 0; j < mp->mchk_cols; j += 1) {
                check_value_at(ret.i32_16x16[i][j], ret_vals[i][j], i, j);
            } // for
        } // for

        mops_v8si_destroy(mp);
    }
    
    // -- 16x16 chunk -- //
    {
        int32_t ret_vals[16][16] = {
            {22, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 22},
            {18, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 18},
            {18, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 18},
            {18, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 18},
            {18, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 18},
            {18, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 18},
            {18, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 18},
            {18, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 18},
            {18, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 18},
            {18, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 18},
            {18, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 18},
            {18, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 18},
            {18, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 18},
            {18, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 18},
            {18, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 18},
            {22, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 22},
        };
        mp = mops_v8si_create();
        memset(&ret, 0, sizeof(ret));

        mp->lchk_rows = 16;
        mp->lchk_cols = 16;
        mp->rchk_rows = 16;
        mp->rchk_cols = 16;
        mp->mchk_rows = 16;
        mp->mchk_cols = 16;

        v8si_multiply_chunk_partly(&ret, &qrcode_16x16, &qrcode_16x16, mp);

        for (i = 0; i < mp->mchk_rows; i += 1) {
            for (j = 0; j < mp->mchk_cols; j += 1) {
                check_value_at(ret.i32_16x16[i][j], ret_vals[i][j], i, j);
            } // for
        } // for

        mops_v8si_destroy(mp);
    }
    
    // -- 5x2 and 2x3 chunk -- //
    {
        mx_chunk_t lhs = {
            .i32_8x8 = {
                {2, 1, 0, 0, 0, 0, 0, 0},
                {1, 1, 0, 0, 0, 0, 0, 0},
                {1, 1, 0, 0, 0, 0, 0, 0},
                {1, 1, 0, 0, 0, 0, 0, 0},
                {1, 1, 0, 0, 0, 0, 0, 0},
            }
        };
        mx_chunk_t rhs = {
            .i32_16x16 = {
                {2, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
                {1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
                {1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
                {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
                {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
                {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
                {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
                {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
                {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
                {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
                {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
                {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
                {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
                {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
                {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
                {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}
            }
        };
        int32_t ret_vals[16][16] = {
            {5, 3, 3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
            {3, 2, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
            {3, 2, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
            {3, 2, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
            {3, 2, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
            {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
            {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
            {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
            {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
            {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
            {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
            {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
            {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
            {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
            {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
            {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
        };
        mp = mops_v8si_create();
        memset(&ret, 0, sizeof(ret));

        mp->lchk_rows = 5;
        mp->lchk_cols = 2;
        mp->rchk_rows = 3; // Chunk on the right hand side has swapped rows and cols.
        mp->rchk_cols = 2; // Chunk on the right hand side has swapped rows and cols.
        mp->mchk_rows = 5;
        mp->mchk_cols = 3;

        v8si_multiply_chunk_partly(&ret, &lhs, &rhs, mp);

        for (i = 0; i < mp->mchk_rows; i += 1) {
            for (j = 0; j < mp->mchk_cols; j += 1) {
                check_value_at(ret.i32_8x8[i][j], ret_vals[i][j], i, j);
            } // for
        } // for

        mops_v8si_destroy(mp);
    }
    
    // -- 1x9 and 9x8 chunk -- //
    {
        int32_t ret_vals[16][16] = {
            {12, 10, 10, 10, 10, 10, 10, 10, 0, 0, 0, 0, 0, 0, 0, 0},
            { 0,  0,  0,  0,  0,  0,  0,  0, 0, 0, 0, 0, 0, 0, 0, 0},
            { 0,  0,  0,  0,  0,  0,  0,  0, 0, 0, 0, 0, 0, 0, 0, 0},
            { 0,  0,  0,  0,  0,  0,  0,  0, 0, 0, 0, 0, 0, 0, 0, 0},
            { 0,  0,  0,  0,  0,  0,  0,  0, 0, 0, 0, 0, 0, 0, 0, 0},
            { 0,  0,  0,  0,  0,  0,  0,  0, 0, 0, 0, 0, 0, 0, 0, 0},
            { 0,  0,  0,  0,  0,  0,  0,  0, 0, 0, 0, 0, 0, 0, 0, 0},
            { 0,  0,  0,  0,  0,  0,  0,  0, 0, 0, 0, 0, 0, 0, 0, 0},
            { 0,  0,  0,  0,  0,  0,  0,  0, 0, 0, 0, 0, 0, 0, 0, 0},
            { 0,  0,  0,  0,  0,  0,  0,  0, 0, 0, 0, 0, 0, 0, 0, 0},
            { 0,  0,  0,  0,  0,  0,  0,  0, 0, 0, 0, 0, 0, 0, 0, 0},
            { 0,  0,  0,  0,  0,  0,  0,  0, 0, 0, 0, 0, 0, 0, 0, 0},
            { 0,  0,  0,  0,  0,  0,  0,  0, 0, 0, 0, 0, 0, 0, 0, 0},
            { 0,  0,  0,  0,  0,  0,  0,  0, 0, 0, 0, 0, 0, 0, 0, 0},
            { 0,  0,  0,  0,  0,  0,  0,  0, 0, 0, 0, 0, 0, 0, 0, 0},
            { 0,  0,  0,  0,  0,  0,  0,  0, 0, 0, 0, 0, 0, 0, 0, 0},
        };
        mp = mops_v8si_create();
        memset(&ret, 0, sizeof(ret));

        mp->lchk_rows = 1;
        mp->lchk_cols = 9;
        mp->rchk_rows = 9;
        mp->rchk_cols = 8;
        mp->mchk_rows = 1;
        mp->mchk_cols = 8;

        v8si_multiply_chunk_partly(&ret, &qrcode_16x16, &qrcode_16x16, mp);

        for (i = 0; i < mp->mchk_rows; i += 1) {
            for (j = 0; j < mp->mchk_cols; j += 1) {
                check_value_at(ret.i32_8x8[i][j], ret_vals[i][j], i, j);
            } // for
        } // for

        mops_v8si_destroy(mp);
    }
}

Test(InternalFunc, v8si_multiply_scalar_chunk_fully)
{
    mx_chunk_t dst;
    uint32_t i = 0;
    uint32_t j = 0;
    
    // -- 16x16 chunk -- //
    {
        v8si_t factor = {2, 2, 2, 2, 2, 2, 2, 2};
        mx_chunk_t src = {
            .v8si_16x2 = {
                {{  0,   1,   2,   3,   4,   5,   6,   7}, {  8,   9,  10,  11,  12,  13,  14,  15}},
                {{ 16,  17,  18,  19,  20,  21,  22,  23}, { 24,  25,  26,  27,  28,  29,  30,  31}},
                {{ 32,  33,  34,  35,  36,  37,  38,  39}, { 40,  41,  42,  43,  44,  45,  46,  47}},
                {{ 48,  49,  50,  51,  52,  53,  54,  55}, { 56,  57,  58,  59,  60,  61,  62,  63}},
                {{ 64,  65,  66,  67,  68,  69,  70,  71}, { 72,  73,  74,  75,  76,  77,  78,  79}},
                {{ 80,  81,  82,  83,  84,  85,  86,  87}, { 88,  89,  90,  91,  92,  93,  94,  95}},
                {{ 96,  97,  98,  99, 100, 101, 102, 103}, {104, 105, 106, 107, 108, 109, 110, 111}},
                {{112, 113, 114, 115, 116, 117, 118, 119}, {120, 121, 122, 123, 124, 125, 126, 127}},
                {{128, 129, 130, 131, 132, 133, 134, 135}, {136, 137, 138, 139, 140, 141, 142, 143}},
                {{144, 145, 146, 147, 148, 149, 150, 151}, {152, 153, 154, 155, 156, 157, 158, 159}},
                {{160, 161, 162, 163, 164, 165, 166, 167}, {168, 169, 170, 171, 172, 173, 174, 175}},
                {{176, 177, 178, 179, 180, 181, 182, 183}, {184, 185, 186, 187, 188, 189, 190, 191}},
                {{192, 193, 194, 195, 196, 197, 198, 199}, {200, 201, 202, 203, 204, 205, 206, 207}},
                {{208, 209, 210, 211, 212, 213, 214, 215}, {216, 217, 218, 219, 220, 221, 222, 223}},
                {{224, 225, 226, 227, 228, 229, 230, 231}, {232, 233, 234, 235, 236, 237, 238, 239}},
                {{240, 241, 242, 243, 244, 245, 246, 247}, {248, 249, 250, 251, 252, 253, 254, 255}},
            }
        };

        memset(&dst, 0, sizeof(dst));

        v8si_multiply_scalar_chunk_fully(&dst, &src, &factor);
        for (i = 0; i < 16; i += 1) {
            for (j = 0; j < 2; j += 1) {
                check_value_at(dst.v8si_16x2[i][j][0], src.v8si_16x2[i][j][0] * 2, i, j * 8 + 0);
                check_value_at(dst.v8si_16x2[i][j][1], src.v8si_16x2[i][j][1] * 2, i, j * 8 + 1);
                check_value_at(dst.v8si_16x2[i][j][2], src.v8si_16x2[i][j][2] * 2, i, j * 8 + 2);
                check_value_at(dst.v8si_16x2[i][j][3], src.v8si_16x2[i][j][3] * 2, i, j * 8 + 3);
                check_value_at(dst.v8si_16x2[i][j][4], src.v8si_16x2[i][j][4] * 2, i, j * 8 + 4);
                check_value_at(dst.v8si_16x2[i][j][5], src.v8si_16x2[i][j][5] * 2, i, j * 8 + 5);
                check_value_at(dst.v8si_16x2[i][j][6], src.v8si_16x2[i][j][6] * 2, i, j * 8 + 6);
                check_value_at(dst.v8si_16x2[i][j][7], src.v8si_16x2[i][j][7] * 2, i, j * 8 + 7);
            } // for
        } // for
    }
}

Test(InternalFunc, v8si_multiply_scalar_chunk_partly)
{
    mx_chunk_t dst;
    uint32_t i = 0;
    uint32_t j = 0;
    
    // -- 1x1 chunk -- //
    {
        v8si_t factor = {2, 2, 2, 2, 2, 2, 2, 2};
        mx_chunk_t src = {
            .v8si_16x1 = {
                {{0, 1, 2, 3, 4, 5, 6, 7}},
            }
        };

        memset(&dst, 0, sizeof(dst));

        v8si_multiply_scalar_chunk_partly(&dst, &src, &factor, 1, 1);
        check_value_at(dst.v8si_16x1[0][0][0], src.v8si_16x1[0][0][0] * 2, 0, 0 * 8 + 0);
    }
    
    // -- 5x5 chunk -- //
    {
        v8si_t factor = {2, 2, 2, 2, 2, 2, 2, 2};
        mx_chunk_t src = {
            .v8si_16x1 = {
                {{  0,   1,   2,   3,   4, 0, 0, 0}},
                {{ 16,  17,  18,  19,  20, 0, 0, 0}},
                {{ 32,  33,  34,  35,  36, 0, 0, 0}},
                {{ 48,  49,  50,  51,  52, 0, 0, 0}},
                {{ 64,  65,  66,  67,  68, 0, 0, 0}},
            }
        };

        memset(&dst, 0, sizeof(dst));

        v8si_multiply_scalar_chunk_partly(&dst, &src, &factor, 5, 5);
        for (i = 0; i < 5; i += 1) {
            check_value_at(dst.v8si_16x1[0][0][0], src.v8si_16x1[0][0][0] * 2, 0, 0 * 8 + 0);
            check_value_at(dst.v8si_16x1[0][0][1], src.v8si_16x1[0][0][1] * 2, 0, 0 * 8 + 1);
            check_value_at(dst.v8si_16x1[0][0][2], src.v8si_16x1[0][0][2] * 2, 0, 0 * 8 + 2);
            check_value_at(dst.v8si_16x1[0][0][3], src.v8si_16x1[0][0][3] * 2, 0, 0 * 8 + 3);
            check_value_at(dst.v8si_16x1[0][0][4], src.v8si_16x1[0][0][4] * 2, 0, 0 * 8 + 4);
        } // for
    }

    // -- 8x8 chunk -- //
    {
        v8si_t factor = {2, 2, 2, 2, 2, 2, 2, 2};
        mx_chunk_t src = {
            .v8si_16x1 = {
                {{  0,   1,   2,   3,   4,   5,   6,   7}},
                {{ 16,  17,  18,  19,  20,  21,  22,  23}},
                {{ 32,  33,  34,  35,  36,  37,  38,  39}},
                {{ 48,  49,  50,  51,  52,  53,  54,  55}},
                {{ 64,  65,  66,  67,  68,  69,  70,  71}},
                {{ 80,  81,  82,  83,  84,  85,  86,  87}},
                {{ 96,  97,  98,  99, 100, 101, 102, 103}},
                {{112, 113, 114, 115, 116, 117, 118, 119}},
            }
        };

        memset(&dst, 0, sizeof(dst));

        v8si_multiply_scalar_chunk_partly(&dst, &src, &factor, 8, 8);
        for (i = 0; i < 8; i += 1) {
            check_value_at(dst.v8si_16x1[0][0][0], src.v8si_16x1[0][0][0] * 2, 0, 0 * 8 + 0);
            check_value_at(dst.v8si_16x1[0][0][1], src.v8si_16x1[0][0][1] * 2, 0, 0 * 8 + 1);
            check_value_at(dst.v8si_16x1[0][0][2], src.v8si_16x1[0][0][2] * 2, 0, 0 * 8 + 2);
            check_value_at(dst.v8si_16x1[0][0][3], src.v8si_16x1[0][0][3] * 2, 0, 0 * 8 + 3);
            check_value_at(dst.v8si_16x1[0][0][4], src.v8si_16x1[0][0][4] * 2, 0, 0 * 8 + 4);
            check_value_at(dst.v8si_16x1[0][0][5], src.v8si_16x1[0][0][5] * 2, 0, 0 * 8 + 5);
            check_value_at(dst.v8si_16x1[0][0][6], src.v8si_16x1[0][0][6] * 2, 0, 0 * 8 + 6);
            check_value_at(dst.v8si_16x1[0][0][7], src.v8si_16x1[0][0][7] * 2, 0, 0 * 8 + 7);
        } // for
    }
    
    // -- 9x9 chunk -- //
    {
        v8si_t factor = {2, 2, 2, 2, 2, 2, 2, 2};
        mx_chunk_t src = {
            .i32_16x16 = {
                {  0,   1,   2,   3,   4,   5,   6,   7,   8},
                { 16,  17,  18,  19,  20,  21,  22,  23,  24},
                { 32,  33,  34,  35,  36,  37,  38,  39,  40},
                { 48,  49,  50,  51,  52,  53,  54,  55,  56},
                { 64,  65,  66,  67,  68,  69,  70,  71,  72},
                { 80,  81,  82,  83,  84,  85,  86,  87,  88},
                { 96,  97,  98,  99, 100, 101, 102, 103, 104},
                {112, 113, 114, 115, 116, 117, 118, 119, 120},
                {128, 129, 130, 131, 132, 133, 134, 135, 136},
            }
        };

        memset(&dst, 0, sizeof(dst));

        v8si_multiply_scalar_chunk_partly(&dst, &src, &factor, 9, 9);
        for (i = 0; i < 9; i += 1) {
            check_value_at(dst.v8si_16x2[0][0][0], src.v8si_16x2[0][0][0] * 2, 0, 0 * 8 + 0);
            check_value_at(dst.v8si_16x2[0][0][1], src.v8si_16x2[0][0][1] * 2, 0, 0 * 8 + 1);
            check_value_at(dst.v8si_16x2[0][0][2], src.v8si_16x2[0][0][2] * 2, 0, 0 * 8 + 2);
            check_value_at(dst.v8si_16x2[0][0][3], src.v8si_16x2[0][0][3] * 2, 0, 0 * 8 + 3);
            check_value_at(dst.v8si_16x2[0][0][4], src.v8si_16x2[0][0][4] * 2, 0, 0 * 8 + 4);
            check_value_at(dst.v8si_16x2[0][0][5], src.v8si_16x2[0][0][5] * 2, 0, 0 * 8 + 5);
            check_value_at(dst.v8si_16x2[0][0][6], src.v8si_16x2[0][0][6] * 2, 0, 0 * 8 + 6);
            check_value_at(dst.v8si_16x2[0][0][7], src.v8si_16x2[0][0][7] * 2, 0, 0 * 8 + 7);

            check_value_at(dst.v8si_16x2[0][1][0], src.v8si_16x2[0][1][0] * 2, 0, 1 * 8 + 0);
        } // for
    }
    
    // -- 16x16 chunk -- //
    {
        v8si_t factor = {2, 2, 2, 2, 2, 2, 2, 2};
        mx_chunk_t src = {
            .v8si_16x2 = {
                {{  0,   1,   2,   3,   4,   5,   6,   7}, {  8,   9,  10,  11,  12,  13,  14,  15}},
                {{ 16,  17,  18,  19,  20,  21,  22,  23}, { 24,  25,  26,  27,  28,  29,  30,  31}},
                {{ 32,  33,  34,  35,  36,  37,  38,  39}, { 40,  41,  42,  43,  44,  45,  46,  47}},
                {{ 48,  49,  50,  51,  52,  53,  54,  55}, { 56,  57,  58,  59,  60,  61,  62,  63}},
                {{ 64,  65,  66,  67,  68,  69,  70,  71}, { 72,  73,  74,  75,  76,  77,  78,  79}},
                {{ 80,  81,  82,  83,  84,  85,  86,  87}, { 88,  89,  90,  91,  92,  93,  94,  95}},
                {{ 96,  97,  98,  99, 100, 101, 102, 103}, {104, 105, 106, 107, 108, 109, 110, 111}},
                {{112, 113, 114, 115, 116, 117, 118, 119}, {120, 121, 122, 123, 124, 125, 126, 127}},
                {{128, 129, 130, 131, 132, 133, 134, 135}, {136, 137, 138, 139, 140, 141, 142, 143}},
                {{144, 145, 146, 147, 148, 149, 150, 151}, {152, 153, 154, 155, 156, 157, 158, 159}},
                {{160, 161, 162, 163, 164, 165, 166, 167}, {168, 169, 170, 171, 172, 173, 174, 175}},
                {{176, 177, 178, 179, 180, 181, 182, 183}, {184, 185, 186, 187, 188, 189, 190, 191}},
                {{192, 193, 194, 195, 196, 197, 198, 199}, {200, 201, 202, 203, 204, 205, 206, 207}},
                {{208, 209, 210, 211, 212, 213, 214, 215}, {216, 217, 218, 219, 220, 221, 222, 223}},
                {{224, 225, 226, 227, 228, 229, 230, 231}, {232, 233, 234, 235, 236, 237, 238, 239}},
                {{240, 241, 242, 243, 244, 245, 246, 247}, {248, 249, 250, 251, 252, 253, 254, 255}},
            }
        };

        memset(&dst, 0, sizeof(dst));

        v8si_multiply_scalar_chunk_partly(&dst, &src, &factor, 16, 16);
        for (i = 0; i < 16; i += 1) {
            for (j = 0; j < 2; j += 1) {
                check_value_at(dst.v8si_16x2[i][j][0], src.v8si_16x2[i][j][0] * 2, i, j * 8 + 0);
                check_value_at(dst.v8si_16x2[i][j][1], src.v8si_16x2[i][j][1] * 2, i, j * 8 + 1);
                check_value_at(dst.v8si_16x2[i][j][2], src.v8si_16x2[i][j][2] * 2, i, j * 8 + 2);
                check_value_at(dst.v8si_16x2[i][j][3], src.v8si_16x2[i][j][3] * 2, i, j * 8 + 3);
                check_value_at(dst.v8si_16x2[i][j][4], src.v8si_16x2[i][j][4] * 2, i, j * 8 + 4);
                check_value_at(dst.v8si_16x2[i][j][5], src.v8si_16x2[i][j][5] * 2, i, j * 8 + 5);
                check_value_at(dst.v8si_16x2[i][j][6], src.v8si_16x2[i][j][6] * 2, i, j * 8 + 6);
                check_value_at(dst.v8si_16x2[i][j][7], src.v8si_16x2[i][j][7] * 2, i, j * 8 + 7);
            } // for
        } // for
    }
}

Test(Operation, mops_v8si_add)
{
    uint32_t i = 0;
    uint32_t j = 0;
    mx_stor_ptr lhs = NULL;
    mx_stor_ptr rhs = NULL;
    mx_stor_ptr mx = NULL;

    // -- 1x1 matrix addition -- //
    {
        lhs = mstr_v8si_create(1, 1);
        mstr_v8si_set(lhs, 0, 0, 1);

        rhs = mstr_v8si_create(1, 1);
        mstr_v8si_set(rhs, 0, 0, 99);

        mx = mstr_v8si_create(1, 1);

        mops_v8si_add(mx, lhs, rhs);

        check_value_at(mstr_v8si_get(mx, 0, 0), 100, 0, 0);

        mstr_v8si_destroy(mx);
        mstr_v8si_destroy(rhs);
        mstr_v8si_destroy(lhs);
    }

    // -- 5x5 matrix addition -- //
    {
        lhs = mstr_v8si_create(5, 5);
        for (i = 0; i < 5; i += 1) {
            for (j = 0; j < 5; j += 1) {
                mstr_v8si_set(lhs, i, j, i * j);
            } // for
        } // for

        rhs = mstr_v8si_create(5, 5);
        for (i = 0; i < 5; i += 1) {
            for (j = 0; j < 5; j += 1) {
                mstr_v8si_set(rhs, i, j, i - j);
            } // for
        } // for

        mx = mstr_v8si_create(5, 5);

        mops_v8si_add(mx, lhs, rhs);

        for (i = 0; i < 5; i += 1) {
            for (j = 0; j < 5; j += 1) {
                check_value_at(mstr_v8si_get(mx, i, j), i * j + i - j, i, j);
            } // for
        } // for

        mstr_v8si_destroy(mx);
        mstr_v8si_destroy(rhs);
        mstr_v8si_destroy(lhs);
    }

    // -- 8x8 matrix addition -- //
    {
        lhs = mstr_v8si_create(8, 8);
        for (i = 0; i < 8; i += 1) {
            for (j = 0; j < 8; j += 1) {
                mstr_v8si_set(lhs, i, j, i * j);
            } // for
        } // for

        rhs = mstr_v8si_create(8, 8);
        for (i = 0; i < 8; i += 1) {
            for (j = 0; j < 8; j += 1) {
                mstr_v8si_set(rhs, i, j, i - j);
            } // for
        } // for

        mx = mstr_v8si_create(8, 8);

        mops_v8si_add(mx, lhs, rhs);

        for (i = 0; i < 8; i += 1) {
            for (j = 0; j < 8; j += 1) {
                check_value_at(mstr_v8si_get(mx, i, j), i * j + i - j, i, j);
            } // for
        } // for

        mstr_v8si_destroy(mx);
        mstr_v8si_destroy(rhs);
        mstr_v8si_destroy(lhs);
    }

    // -- 9x9 matrix addition -- //
    {
        lhs = mstr_v8si_create(9, 9);
        for (i = 0; i < 9; i += 1) {
            for (j = 0; j < 9; j += 1) {
                mstr_v8si_set(lhs, i, j, i * j);
            } // for
        } // for

        rhs = mstr_v8si_create(9, 9);
        for (i = 0; i < 9; i += 1) {
            for (j = 0; j < 9; j += 1) {
                mstr_v8si_set(rhs, i, j, i - j);
            } // for
        } // for

        mx = mstr_v8si_create(9, 9);

        mops_v8si_add(mx, lhs, rhs);

        for (i = 0; i < 9; i += 1) {
            for (j = 0; j < 9; j += 1) {
                check_value_at(mstr_v8si_get(mx, i, j), i * j + i - j, i, j);
            } // for
        } // for

        mstr_v8si_destroy(mx);
        mstr_v8si_destroy(rhs);
        mstr_v8si_destroy(lhs);
    }

    // -- 16x16 matrix addition -- //
    {
        lhs = mstr_v8si_create(16, 16);
        for (i = 0; i < 16; i += 1) {
            for (j = 0; j < 16; j += 1) {
                mstr_v8si_set(lhs, i, j, i * j);
            } // for
        } // for

        rhs = mstr_v8si_create(16, 16);
        for (i = 0; i < 16; i += 1) {
            for (j = 0; j < 16; j += 1) {
                mstr_v8si_set(rhs, i, j, i - j);
            } // for
        } // for

        mx = mstr_v8si_create(16, 16);

        mops_v8si_add(mx, lhs, rhs);

        for (i = 0; i < 16; i += 1) {
            for (j = 0; j < 16; j += 1) {
                check_value_at(mstr_v8si_get(mx, i, j), i * j + i - j, i, j);
            } // for
        } // for

        mstr_v8si_destroy(mx);
        mstr_v8si_destroy(rhs);
        mstr_v8si_destroy(lhs);
    }

    // -- 17x17 matrix addition -- //
    {
        lhs = mstr_v8si_create(17, 17);
        for (i = 0; i < 17; i += 1) {
            for (j = 0; j < 17; j += 1) {
                mstr_v8si_set(lhs, i, j, i * j);
            } // for
        } // for

        rhs = mstr_v8si_create(17, 17);
        for (i = 0; i < 17; i += 1) {
            for (j = 0; j < 17; j += 1) {
                mstr_v8si_set(rhs, i, j, i - j);
            } // for
        } // for

        mx = mstr_v8si_create(17, 17);

        mops_v8si_add(mx, lhs, rhs);

        for (i = 0; i < 17; i += 1) {
            for (j = 0; j < 17; j += 1) {
                check_value_at(mstr_v8si_get(mx, i, j), i * j + i - j, i, j);
            } // for
        } // for

        mstr_v8si_destroy(mx);
        mstr_v8si_destroy(rhs);
        mstr_v8si_destroy(lhs);
    }

    // -- 2x33 matrix addition -- //
    {
        lhs = mstr_v8si_create(2, 33);
        for (i = 0; i < 2; i += 1) {
            for (j = 0; j < 33; j += 1) {
                mstr_v8si_set(lhs, i, j, i * j);
            } // for
        } // for

        rhs = mstr_v8si_create(2, 33);
        for (i = 0; i < 2; i += 1) {
            for (j = 0; j < 33; j += 1) {
                mstr_v8si_set(rhs, i, j, i - j);
            } // for
        } // for

        mx = mstr_v8si_create(2, 33);

        mops_v8si_add(mx, lhs, rhs);

        for (i = 0; i < 2; i += 1) {
            for (j = 0; j < 33; j += 1) {
                check_value_at(mstr_v8si_get(mx, i, j), i * j + i - j, i, j);
            } // for
        } // for

        mstr_v8si_destroy(mx);
        mstr_v8si_destroy(rhs);
        mstr_v8si_destroy(lhs);
    }

    // -- 33x17 matrix addition -- //
    {
        lhs = mstr_v8si_create(33, 17);
        for (i = 0; i < 33; i += 1) {
            for (j = 0; j < 17; j += 1) {
                mstr_v8si_set(lhs, i, j, i * j);
            } // for
        } // for

        rhs = mstr_v8si_create(33, 17);
        for (i = 0; i < 33; i += 1) {
            for (j = 0; j < 17; j += 1) {
                mstr_v8si_set(rhs, i, j, i - j);
            } // for
        } // for

        mx = mstr_v8si_create(33, 17);

        mops_v8si_add(mx, lhs, rhs);

        for (i = 0; i < 33; i += 1) {
            for (j = 0; j < 17; j += 1) {
                check_value_at(mstr_v8si_get(mx, i, j), i * j + i - j, i, j);
            } // for
        } // for

        mstr_v8si_destroy(mx);
        mstr_v8si_destroy(rhs);
        mstr_v8si_destroy(lhs);
    }
}

Test(Operation, mops_v8si_subtract)
{
    uint32_t i = 0;
    uint32_t j = 0;
    mx_stor_ptr lhs = NULL;
    mx_stor_ptr rhs = NULL;
    mx_stor_ptr mx = NULL;

    // -- 1x1 matrix subtraction -- //
    {
        lhs = mstr_v8si_create(1, 1);
        mstr_v8si_set(lhs, 0, 0, 1);

        rhs = mstr_v8si_create(1, 1);
        mstr_v8si_set(rhs, 0, 0, 99);

        mx = mstr_v8si_create(1, 1);

        mops_v8si_subtract(mx, lhs, rhs);

        check_value_at(mstr_v8si_get(mx, 0, 0), -98, 0, 0);

        mstr_v8si_destroy(mx);
        mstr_v8si_destroy(rhs);
        mstr_v8si_destroy(lhs);
    }

    // -- 5x5 matrix subtraction -- //
    {
        lhs = mstr_v8si_create(5, 5);
        for (i = 0; i < 5; i += 1) {
            for (j = 0; j < 5; j += 1) {
                mstr_v8si_set(lhs, i, j, i * j);
            } // for
        } // for

        rhs = mstr_v8si_create(5, 5);
        for (i = 0; i < 5; i += 1) {
            for (j = 0; j < 5; j += 1) {
                mstr_v8si_set(rhs, i, j, i - j);
            } // for
        } // for

        mx = mstr_v8si_create(5, 5);

        mops_v8si_subtract(mx, lhs, rhs);

        for (i = 0; i < 5; i += 1) {
            for (j = 0; j < 5; j += 1) {
                check_value_at(mstr_v8si_get(mx, i, j), i * j - (i - j), i, j);
            } // for
        } // for

        mstr_v8si_destroy(mx);
        mstr_v8si_destroy(rhs);
        mstr_v8si_destroy(lhs);
    }

    // -- 8x8 matrix subtraction -- //
    {
        lhs = mstr_v8si_create(8, 8);
        for (i = 0; i < 8; i += 1) {
            for (j = 0; j < 8; j += 1) {
                mstr_v8si_set(lhs, i, j, i * j);
            } // for
        } // for

        rhs = mstr_v8si_create(8, 8);
        for (i = 0; i < 8; i += 1) {
            for (j = 0; j < 8; j += 1) {
                mstr_v8si_set(rhs, i, j, i - j);
            } // for
        } // for

        mx = mstr_v8si_create(8, 8);

        mops_v8si_subtract(mx, lhs, rhs);

        for (i = 0; i < 8; i += 1) {
            for (j = 0; j < 8; j += 1) {
                check_value_at(mstr_v8si_get(mx, i, j), i * j - (i - j), i, j);
            } // for
        } // for

        mstr_v8si_destroy(mx);
        mstr_v8si_destroy(rhs);
        mstr_v8si_destroy(lhs);
    }

    // -- 9x9 matrix subtraction -- //
    {
        lhs = mstr_v8si_create(9, 9);
        for (i = 0; i < 9; i += 1) {
            for (j = 0; j < 9; j += 1) {
                mstr_v8si_set(lhs, i, j, i * j);
            } // for
        } // for

        rhs = mstr_v8si_create(9, 9);
        for (i = 0; i < 9; i += 1) {
            for (j = 0; j < 9; j += 1) {
                mstr_v8si_set(rhs, i, j, i - j);
            } // for
        } // for

        mx = mstr_v8si_create(9, 9);

        mops_v8si_subtract(mx, lhs, rhs);

        for (i = 0; i < 9; i += 1) {
            for (j = 0; j < 9; j += 1) {
                check_value_at(mstr_v8si_get(mx, i, j), i * j - (i - j), i, j);
            } // for
        } // for

        mstr_v8si_destroy(mx);
        mstr_v8si_destroy(rhs);
        mstr_v8si_destroy(lhs);
    }

    // -- 16x16 matrix subtraction -- //
    {
        lhs = mstr_v8si_create(16, 16);
        for (i = 0; i < 16; i += 1) {
            for (j = 0; j < 16; j += 1) {
                mstr_v8si_set(lhs, i, j, i * j);
            } // for
        } // for

        rhs = mstr_v8si_create(16, 16);
        for (i = 0; i < 16; i += 1) {
            for (j = 0; j < 16; j += 1) {
                mstr_v8si_set(rhs, i, j, i - j);
            } // for
        } // for

        mx = mstr_v8si_create(16, 16);

        mops_v8si_subtract(mx, lhs, rhs);

        for (i = 0; i < 16; i += 1) {
            for (j = 0; j < 16; j += 1) {
                check_value_at(mstr_v8si_get(mx, i, j), i * j - (i - j), i, j);
            } // for
        } // for

        mstr_v8si_destroy(mx);
        mstr_v8si_destroy(rhs);
        mstr_v8si_destroy(lhs);
    }

    // -- 17x17 matrix subtraction -- //
    {
        lhs = mstr_v8si_create(17, 17);
        for (i = 0; i < 17; i += 1) {
            for (j = 0; j < 17; j += 1) {
                mstr_v8si_set(lhs, i, j, i * j);
            } // for
        } // for

        rhs = mstr_v8si_create(17, 17);
        for (i = 0; i < 17; i += 1) {
            for (j = 0; j < 17; j += 1) {
                mstr_v8si_set(rhs, i, j, i - j);
            } // for
        } // for

        mx = mstr_v8si_create(17, 17);

        mops_v8si_subtract(mx, lhs, rhs);

        for (i = 0; i < 17; i += 1) {
            for (j = 0; j < 17; j += 1) {
                check_value_at(mstr_v8si_get(mx, i, j), i * j - (i - j), i, j);
            } // for
        } // for

        mstr_v8si_destroy(mx);
        mstr_v8si_destroy(rhs);
        mstr_v8si_destroy(lhs);
    }

    // -- 2x33 matrix subtraction -- //
    {
        lhs = mstr_v8si_create(2, 33);
        for (i = 0; i < 2; i += 1) {
            for (j = 0; j < 33; j += 1) {
                mstr_v8si_set(lhs, i, j, i * j);
            } // for
        } // for

        rhs = mstr_v8si_create(2, 33);
        for (i = 0; i < 2; i += 1) {
            for (j = 0; j < 33; j += 1) {
                mstr_v8si_set(rhs, i, j, i - j);
            } // for
        } // for

        mx = mstr_v8si_create(2, 33);

        mops_v8si_subtract(mx, lhs, rhs);

        for (i = 0; i < 2; i += 1) {
            for (j = 0; j < 33; j += 1) {
                check_value_at(mstr_v8si_get(mx, i, j), i * j - (i - j), i, j);
            } // for
        } // for

        mstr_v8si_destroy(mx);
        mstr_v8si_destroy(rhs);
        mstr_v8si_destroy(lhs);
    }

    // -- 33x17 matrix subtraction -- //
    {
        lhs = mstr_v8si_create(33, 17);
        for (i = 0; i < 33; i += 1) {
            for (j = 0; j < 17; j += 1) {
                mstr_v8si_set(lhs, i, j, i * j);
            } // for
        } // for

        rhs = mstr_v8si_create(33, 17);
        for (i = 0; i < 33; i += 1) {
            for (j = 0; j < 17; j += 1) {
                mstr_v8si_set(rhs, i, j, i - j);
            } // for
        } // for

        mx = mstr_v8si_create(33, 17);

        mops_v8si_subtract(mx, lhs, rhs);

        for (i = 0; i < 33; i += 1) {
            for (j = 0; j < 17; j += 1) {
                check_value_at(mstr_v8si_get(mx, i, j), i * j - (i - j), i, j);
            } // for
        } // for

        mstr_v8si_destroy(mx);
        mstr_v8si_destroy(rhs);
        mstr_v8si_destroy(lhs);
    }
}

Test(Operation, mops_v8si_multiply_scalar)
{
    uint32_t i = 0;
    uint32_t j = 0;
    mx_stor_ptr src = NULL;
    mx_stor_ptr mx = NULL;

    // -- 1x1 matrix scalar multiplication -- //
    {
        src = mstr_v8si_create(1, 1);
        mstr_v8si_set(src, 0, 0, 99);

        mx = mstr_v8si_create(1, 1);

        mops_v8si_multiply_scalar(mx, src, 2);

        check_value_at(mstr_v8si_get(mx, 0, 0), 198, 0, 0);

        mstr_v8si_destroy(mx);
        mstr_v8si_destroy(src);
    }

    // -- 5x5 matrix scalar multiplication -- //
    {
        src = mstr_v8si_create(5, 5);
        for (i = 0; i < 5; i += 1) {
            for (j = 0; j < 5; j += 1) {
                mstr_v8si_set(src, i, j, i - j);
            } // for
        } // for

        mx = mstr_v8si_create(5, 5);

        mops_v8si_multiply_scalar(mx, src, 3);

        for (i = 0; i < 5; i += 1) {
            for (j = 0; j < 5; j += 1) {
                check_value_at(mstr_v8si_get(mx, i, j), 3 * (i - j), i, j);
            } // for
        } // for

        mstr_v8si_destroy(mx);
        mstr_v8si_destroy(src);
    }

    // -- 8x8 matrix scalar multiplication -- //
    {
        src = mstr_v8si_create(8, 8);
        for (i = 0; i < 8; i += 1) {
            for (j = 0; j < 8; j += 1) {
                mstr_v8si_set(src, i, j, i - j);
            } // for
        } // for

        mx = mstr_v8si_create(8, 8);

        mops_v8si_multiply_scalar(mx, src, 14);

        for (i = 0; i < 8; i += 1) {
            for (j = 0; j < 8; j += 1) {
                check_value_at(mstr_v8si_get(mx, i, j), 14 * (i - j), i, j);
            } // for
        } // for

        mstr_v8si_destroy(mx);
        mstr_v8si_destroy(src);
    }

    // -- 9x9 matrix scalar multiplication -- //
    {
        src = mstr_v8si_create(9, 9);
        for (i = 0; i < 9; i += 1) {
            for (j = 0; j < 9; j += 1) {
                mstr_v8si_set(src, i, j, i - j);
            } // for
        } // for

        mx = mstr_v8si_create(9, 9);

        mops_v8si_multiply_scalar(mx, src, 7);

        for (i = 0; i < 9; i += 1) {
            for (j = 0; j < 9; j += 1) {
                check_value_at(mstr_v8si_get(mx, i, j), 7 * (i - j), i, j);
            } // for
        } // for

        mstr_v8si_destroy(mx);
        mstr_v8si_destroy(src);
    }

    // -- 16x16 matrix scalar multiplication -- //
    {
        src = mstr_v8si_create(16, 16);
        for (i = 0; i < 16; i += 1) {
            for (j = 0; j < 16; j += 1) {
                mstr_v8si_set(src, i, j, i - j);
            } // for
        } // for

        mx = mstr_v8si_create(16, 16);

        mops_v8si_multiply_scalar(mx, src, 25);

        for (i = 0; i < 16; i += 1) {
            for (j = 0; j < 16; j += 1) {
                check_value_at(mstr_v8si_get(mx, i, j), 25 * (i - j), i, j);
            } // for
        } // for

        mstr_v8si_destroy(mx);
        mstr_v8si_destroy(src);
    }

    // -- 17x17 matrix scalar multiplication -- //
    {
        src = mstr_v8si_create(17, 17);
        for (i = 0; i < 17; i += 1) {
            for (j = 0; j < 17; j += 1) {
                mstr_v8si_set(src, i, j, i - j);
            } // for
        } // for

        mx = mstr_v8si_create(17, 17);

        mops_v8si_multiply_scalar(mx, src, 99);

        for (i = 0; i < 17; i += 1) {
            for (j = 0; j < 17; j += 1) {
                check_value_at(mstr_v8si_get(mx, i, j), 99 * (i - j), i, j);
            } // for
        } // for

        mstr_v8si_destroy(mx);
        mstr_v8si_destroy(src);
    }

    // -- 2x33 matrix scalar multiplication -- //
    {
        src = mstr_v8si_create(2, 33);
        for (i = 0; i < 2; i += 1) {
            for (j = 0; j < 33; j += 1) {
                mstr_v8si_set(src, i, j, i - j);
            } // for
        } // for

        mx = mstr_v8si_create(2, 33);

        mops_v8si_multiply_scalar(mx, src, 13);

        for (i = 0; i < 2; i += 1) {
            for (j = 0; j < 33; j += 1) {
                check_value_at(mstr_v8si_get(mx, i, j), 13 * (i - j), i, j);
            } // for
        } // for

        mstr_v8si_destroy(mx);
        mstr_v8si_destroy(src);
    }

    // -- 33x17 matrix scalar multiplication -- //
    {
        src = mstr_v8si_create(33, 17);
        for (i = 0; i < 33; i += 1) {
            for (j = 0; j < 17; j += 1) {
                mstr_v8si_set(src, i, j, i - j);
            } // for
        } // for

        mx = mstr_v8si_create(33, 17);

        mops_v8si_multiply_scalar(mx, src, 77);

        for (i = 0; i < 33; i += 1) {
            for (j = 0; j < 17; j += 1) {
                check_value_at(mstr_v8si_get(mx, i, j), 77 * (i - j), i, j);
            } // for
        } // for

        mstr_v8si_destroy(mx);
        mstr_v8si_destroy(src);
    }
}

Test(Operation, mops_v8si_multiply)
{
    uint32_t i = 0;
    uint32_t j = 0;
    mx_oper_ptr mp = NULL;
    mx_stor_ptr lhs = NULL;
    mx_stor_ptr rhs = NULL;
    mx_stor_ptr ret = NULL;

    // -- 1x1 matrix multiplication -- //
    {
        mp = mops_v8si_create();

        lhs = mstr_v8si_create(1, 1);
        mstr_v8si_set(lhs, 0, 0, 11);

        rhs = mstr_v8si_create(1, 1);
        mstr_v8si_set(rhs, 0, 0, 2);

        ret = mstr_v8si_create(1, 1);

        mops_v8si_multiply(mp, lhs, rhs, ret);

        check_value_at(mstr_v8si_get(ret, 0, 0), 22, 0, 0);

        mstr_v8si_destroy(ret);
        mstr_v8si_destroy(rhs);
        mstr_v8si_destroy(lhs);
        mops_v8si_destroy(mp);
    }

    // -- 5x5 matrix multiplication -- //
    {
        int32_t ret_vals[5][5] = {
            {0, 5, 10, 15, 20},
            {0, 5, 10, 15, 20},
            {0, 5, 10, 15, 20},
            {0, 5, 10, 15, 20},
            {0, 5, 10, 15, 20}
        };
        mp = mops_v8si_create();

        lhs = mstr_v8si_create(5, 5);
        for (i = 0; i < 5; i += 1) {
            for (j = 0; j < 5; j += 1) {
                mstr_v8si_set(lhs, i, j, 1);
            } // for
        } // for

        rhs = mstr_v8si_create(5, 5);
        for (i = 0; i < 5; i += 1) {
            for (j = 0; j < 5; j += 1) {
                mstr_v8si_set(rhs, i, j, j);
            } // for
        } // for

        ret = mstr_v8si_create(5, 5);

        mops_v8si_multiply(mp, lhs, rhs, ret);

        for (i = 0; i < 5; i += 1) {
            for (j = 0; j < 5; j += 1) {
                check_value_at(mstr_v8si_get(ret, i, j), ret_vals[i][j], i, j);
            } // for
        } // for

        mstr_v8si_destroy(ret);
        mstr_v8si_destroy(rhs);
        mstr_v8si_destroy(lhs);
        mops_v8si_destroy(mp);
    }

    // -- 8x8 matrix multiplication -- //
    {
        int32_t ret_vals[8][8] = {
            {0, 8, 16, 24, 32, 40, 48, 56},
            {0, 8, 16, 24, 32, 40, 48, 56},
            {0, 8, 16, 24, 32, 40, 48, 56},
            {0, 8, 16, 24, 32, 40, 48, 56},
            {0, 8, 16, 24, 32, 40, 48, 56},
            {0, 8, 16, 24, 32, 40, 48, 56},
            {0, 8, 16, 24, 32, 40, 48, 56},
            {0, 8, 16, 24, 32, 40, 48, 56}
        };
        mp = mops_v8si_create();

        lhs = mstr_v8si_create(8, 8);
        for (i = 0; i < 8; i += 1) {
            for (j = 0; j < 8; j += 1) {
                mstr_v8si_set(lhs, i, j, 1);
            } // for
        } // for

        rhs = mstr_v8si_create(8, 8);
        for (i = 0; i < 8; i += 1) {
            for (j = 0; j < 8; j += 1) {
                mstr_v8si_set(rhs, i, j, j);
            } // for
        } // for

        ret = mstr_v8si_create(8, 8);

        mops_v8si_multiply(mp, lhs, rhs, ret);

        for (i = 0; i < 8; i += 1) {
            for (j = 0; j < 8; j += 1) {
                check_value_at(mstr_v8si_get(ret, i, j), ret_vals[i][j], i, j);
            } // for
        } // for

        mstr_v8si_destroy(ret);
        mstr_v8si_destroy(rhs);
        mstr_v8si_destroy(lhs);
        mops_v8si_destroy(mp);
    }

    // -- 9x9 matrix multiplication -- //
    {
        int32_t ret_vals[9][9] = {
            {0, 9, 18, 27, 36, 45, 54, 63, 72},
            {0, 9, 18, 27, 36, 45, 54, 63, 72},
            {0, 9, 18, 27, 36, 45, 54, 63, 72},
            {0, 9, 18, 27, 36, 45, 54, 63, 72},
            {0, 9, 18, 27, 36, 45, 54, 63, 72},
            {0, 9, 18, 27, 36, 45, 54, 63, 72},
            {0, 9, 18, 27, 36, 45, 54, 63, 72},
            {0, 9, 18, 27, 36, 45, 54, 63, 72},
            {0, 9, 18, 27, 36, 45, 54, 63, 72}
        };
        mp = mops_v8si_create();

        lhs = mstr_v8si_create(9, 9);
        for (i = 0; i < 9; i += 1) {
            for (j = 0; j < 9; j += 1) {
                mstr_v8si_set(lhs, i, j, 1);
            } // for
        } // for

        rhs = mstr_v8si_create(9, 9);
        for (i = 0; i < 9; i += 1) {
            for (j = 0; j < 9; j += 1) {
                mstr_v8si_set(rhs, i, j, j);
            } // for
        } // for

        ret = mstr_v8si_create(9, 9);

        mops_v8si_multiply(mp, lhs, rhs, ret);

        for (i = 0; i < 9; i += 1) {
            for (j = 0; j < 9; j += 1) {
                check_value_at(mstr_v8si_get(ret, i, j), ret_vals[i][j], i, j);
            } // for
        } // for

        mstr_v8si_destroy(ret);
        mstr_v8si_destroy(rhs);
        mstr_v8si_destroy(lhs);
        mops_v8si_destroy(mp);
    }

    // -- 16x16 matrix multiplication -- //
    {
        int32_t ret_vals[16][16] = {
            {0, 16, 32, 48, 64, 80, 96, 112, 128, 144, 160, 176, 192, 208, 224, 240},
            {0, 16, 32, 48, 64, 80, 96, 112, 128, 144, 160, 176, 192, 208, 224, 240},
            {0, 16, 32, 48, 64, 80, 96, 112, 128, 144, 160, 176, 192, 208, 224, 240},
            {0, 16, 32, 48, 64, 80, 96, 112, 128, 144, 160, 176, 192, 208, 224, 240},
            {0, 16, 32, 48, 64, 80, 96, 112, 128, 144, 160, 176, 192, 208, 224, 240},
            {0, 16, 32, 48, 64, 80, 96, 112, 128, 144, 160, 176, 192, 208, 224, 240},
            {0, 16, 32, 48, 64, 80, 96, 112, 128, 144, 160, 176, 192, 208, 224, 240},
            {0, 16, 32, 48, 64, 80, 96, 112, 128, 144, 160, 176, 192, 208, 224, 240},
            {0, 16, 32, 48, 64, 80, 96, 112, 128, 144, 160, 176, 192, 208, 224, 240},
            {0, 16, 32, 48, 64, 80, 96, 112, 128, 144, 160, 176, 192, 208, 224, 240},
            {0, 16, 32, 48, 64, 80, 96, 112, 128, 144, 160, 176, 192, 208, 224, 240},
            {0, 16, 32, 48, 64, 80, 96, 112, 128, 144, 160, 176, 192, 208, 224, 240},
            {0, 16, 32, 48, 64, 80, 96, 112, 128, 144, 160, 176, 192, 208, 224, 240},
            {0, 16, 32, 48, 64, 80, 96, 112, 128, 144, 160, 176, 192, 208, 224, 240},
            {0, 16, 32, 48, 64, 80, 96, 112, 128, 144, 160, 176, 192, 208, 224, 240},
            {0, 16, 32, 48, 64, 80, 96, 112, 128, 144, 160, 176, 192, 208, 224, 240}
        };
        mp = mops_v8si_create();

        lhs = mstr_v8si_create(16, 16);
        for (i = 0; i < 16; i += 1) {
            for (j = 0; j < 16; j += 1) {
                mstr_v8si_set(lhs, i, j, 1);
            } // for
        } // for

        rhs = mstr_v8si_create(16, 16);
        for (i = 0; i < 16; i += 1) {
            for (j = 0; j < 16; j += 1) {
                mstr_v8si_set(rhs, i, j, j);
            } // for
        } // for

        ret = mstr_v8si_create(16, 16);

        mops_v8si_multiply(mp, lhs, rhs, ret);

        for (i = 0; i < 16; i += 1) {
            for (j = 0; j < 16; j += 1) {
                check_value_at(mstr_v8si_get(ret, i, j), ret_vals[i][j], i, j);
            } // for
        } // for

        mstr_v8si_destroy(ret);
        mstr_v8si_destroy(rhs);
        mstr_v8si_destroy(lhs);
        mops_v8si_destroy(mp);
    }

    // -- 17x17 matrix multiplication -- //
    {
        int32_t ret_vals[17][17] = {
            {0, 17, 34, 51, 68, 85, 102, 119, 136, 153, 170, 187, 204, 221, 238, 255, 272},
            {0, 17, 34, 51, 68, 85, 102, 119, 136, 153, 170, 187, 204, 221, 238, 255, 272},
            {0, 17, 34, 51, 68, 85, 102, 119, 136, 153, 170, 187, 204, 221, 238, 255, 272},
            {0, 17, 34, 51, 68, 85, 102, 119, 136, 153, 170, 187, 204, 221, 238, 255, 272},
            {0, 17, 34, 51, 68, 85, 102, 119, 136, 153, 170, 187, 204, 221, 238, 255, 272},
            {0, 17, 34, 51, 68, 85, 102, 119, 136, 153, 170, 187, 204, 221, 238, 255, 272},
            {0, 17, 34, 51, 68, 85, 102, 119, 136, 153, 170, 187, 204, 221, 238, 255, 272},
            {0, 17, 34, 51, 68, 85, 102, 119, 136, 153, 170, 187, 204, 221, 238, 255, 272},
            {0, 17, 34, 51, 68, 85, 102, 119, 136, 153, 170, 187, 204, 221, 238, 255, 272},
            {0, 17, 34, 51, 68, 85, 102, 119, 136, 153, 170, 187, 204, 221, 238, 255, 272},
            {0, 17, 34, 51, 68, 85, 102, 119, 136, 153, 170, 187, 204, 221, 238, 255, 272},
            {0, 17, 34, 51, 68, 85, 102, 119, 136, 153, 170, 187, 204, 221, 238, 255, 272},
            {0, 17, 34, 51, 68, 85, 102, 119, 136, 153, 170, 187, 204, 221, 238, 255, 272},
            {0, 17, 34, 51, 68, 85, 102, 119, 136, 153, 170, 187, 204, 221, 238, 255, 272},
            {0, 17, 34, 51, 68, 85, 102, 119, 136, 153, 170, 187, 204, 221, 238, 255, 272},
            {0, 17, 34, 51, 68, 85, 102, 119, 136, 153, 170, 187, 204, 221, 238, 255, 272},
            {0, 17, 34, 51, 68, 85, 102, 119, 136, 153, 170, 187, 204, 221, 238, 255, 272}
        };
        mp = mops_v8si_create();

        lhs = mstr_v8si_create(17, 17);
        for (i = 0; i < 17; i += 1) {
            for (j = 0; j < 17; j += 1) {
                mstr_v8si_set(lhs, i, j, 1);
            } // for
        } // for

        rhs = mstr_v8si_create(17, 17);
        for (i = 0; i < 17; i += 1) {
            for (j = 0; j < 17; j += 1) {
                mstr_v8si_set(rhs, i, j, j);
            } // for
        } // for

        ret = mstr_v8si_create(17, 17);

        mops_v8si_multiply(mp, lhs, rhs, ret);

        for (i = 0; i < 17; i += 1) {
            for (j = 0; j < 17; j += 1) {
                check_value_at(mstr_v8si_get(ret, i, j), ret_vals[i][j], i, j);
            } // for
        } // for

        mstr_v8si_destroy(ret);
        mstr_v8si_destroy(rhs);
        mstr_v8si_destroy(lhs);
        mops_v8si_destroy(mp);
    }

    // -- 9x33 and 33x9 matrix multiplication -- //
    {
        int32_t ret_vals[9][9] = {
            {0, 33, 66, 99, 132, 165, 198, 231, 264},
            {0, 33, 66, 99, 132, 165, 198, 231, 264},
            {0, 33, 66, 99, 132, 165, 198, 231, 264},
            {0, 33, 66, 99, 132, 165, 198, 231, 264},
            {0, 33, 66, 99, 132, 165, 198, 231, 264},
            {0, 33, 66, 99, 132, 165, 198, 231, 264},
            {0, 33, 66, 99, 132, 165, 198, 231, 264},
            {0, 33, 66, 99, 132, 165, 198, 231, 264},
            {0, 33, 66, 99, 132, 165, 198, 231, 264}
        };
        mp = mops_v8si_create();

        lhs = mstr_v8si_create(9, 33);
        for (i = 0; i < 9; i += 1) {
            for (j = 0; j < 33; j += 1) {
                mstr_v8si_set(lhs, i, j, 1);
            } // for
        } // for

        rhs = mstr_v8si_create(33, 9);
        for (i = 0; i < 33; i += 1) {
            for (j = 0; j < 9; j += 1) {
                mstr_v8si_set(rhs, i, j, j);
            } // for
        } // for

        ret = mstr_v8si_create(9, 9);

        mops_v8si_multiply(mp, lhs, rhs, ret);

        for (i = 0; i < 9; i += 1) {
            for (j = 0; j < 9; j += 1) {
                check_value_at(mstr_v8si_get(ret, i, j), ret_vals[i][j], i, j);
            } // for
        } // for

        mstr_v8si_destroy(ret);
        mstr_v8si_destroy(rhs);
        mstr_v8si_destroy(lhs);
        mops_v8si_destroy(mp);
    }
}

Test(Operation, mops_v8si_transpose)
{
    uint32_t i = 0;
    uint32_t j = 0;
    mx_oper_ptr mp = NULL;
    mx_stor_ptr src = NULL;
    mx_stor_ptr dst = NULL;

    // -- 1x1 matrix transpose -- //
    {
        mp = mops_v8si_create();

        src = mstr_v8si_create(1, 1);
        mstr_v8si_set(src, 0, 0, 11);

        dst = mstr_v8si_create(1, 1);
        mops_v8si_transpose(mp, src, dst);

        check_value_at(mstr_v8si_get(dst, 0, 0), 11, 0, 0);

        mstr_v8si_destroy(dst);
        mstr_v8si_destroy(src);
        mops_v8si_destroy(mp);
    }

    // -- 5x5 matrix transpose -- //
    {
        mp = mops_v8si_create();

        src = mstr_v8si_create(5, 5);

        for (i = 0; i < 5; i += 1) {
            for (j = 0; j < 5; j += 1) {
                mstr_v8si_set(src, i, j, i * j);
            } // for
        } // for

        dst = mstr_v8si_create(5, 5);
        mops_v8si_transpose(mp, src, dst);

        for (i = 0; i < 5; i += 1) {
            for (j = 0; j < 5; j += 1) {
                check_value_at(mstr_v8si_get(dst, i, j), mstr_v8si_get(src, j, i), i, j);
            } // for
        } // for

        mstr_v8si_destroy(dst);
        mstr_v8si_destroy(src);
        mops_v8si_destroy(mp);
    }

    // -- 8x8 matrix transpose -- //
    {
        mp = mops_v8si_create();

        src = mstr_v8si_create(8, 8);

        for (i = 0; i < 8; i += 1) {
            for (j = 0; j < 8; j += 1) {
                mstr_v8si_set(src, i, j, i * j);
            } // for
        } // for

        dst = mstr_v8si_create(8, 8);
        mops_v8si_transpose(mp, src, dst);

        for (i = 0; i < 8; i += 1) {
            for (j = 0; j < 8; j += 1) {
                check_value_at(mstr_v8si_get(dst, i, j), mstr_v8si_get(src, j, i), i, j);
            } // for
        } // for

        mstr_v8si_destroy(dst);
        mstr_v8si_destroy(src);
        mops_v8si_destroy(mp);
    }

    // -- 9x9 matrix transpose -- //
    {
        mp = mops_v8si_create();

        src = mstr_v8si_create(9, 9);

        for (i = 0; i < 9; i += 1) {
            for (j = 0; j < 9; j += 1) {
                mstr_v8si_set(src, i, j, i * j);
            } // for
        } // for

        dst = mstr_v8si_create(9, 9);
        mops_v8si_transpose(mp, src, dst);

        for (i = 0; i < 9; i += 1) {
            for (j = 0; j < 9; j += 1) {
                check_value_at(mstr_v8si_get(dst, i, j), mstr_v8si_get(src, j, i), i, j);
            } // for
        } // for

        mstr_v8si_destroy(dst);
        mstr_v8si_destroy(src);
        mops_v8si_destroy(mp);
    }

    // -- 16x16 matrix transpose -- //
    {
        mp = mops_v8si_create();

        src = mstr_v8si_create(16, 16);

        for (i = 0; i < 16; i += 1) {
            for (j = 0; j < 16; j += 1) {
                mstr_v8si_set(src, i, j, i * j);
            } // for
        } // for

        dst = mstr_v8si_create(16, 16);
        mops_v8si_transpose(mp, src, dst);

        for (i = 0; i < 16; i += 1) {
            for (j = 0; j < 16; j += 1) {
                check_value_at(mstr_v8si_get(dst, i, j), mstr_v8si_get(src, j, i), i, j);
            } // for
        } // for

        mstr_v8si_destroy(dst);
        mstr_v8si_destroy(src);
        mops_v8si_destroy(mp);
    }

    // -- 17x17 matrix transpose -- //
    {
        mp = mops_v8si_create();

        src = mstr_v8si_create(17, 17);

        for (i = 0; i < 17; i += 1) {
            for (j = 0; j < 17; j += 1) {
                mstr_v8si_set(src, i, j, i * j);
            } // for
        } // for

        dst = mstr_v8si_create(17, 17);
        mops_v8si_transpose(mp, src, dst);

        for (i = 0; i < 17; i += 1) {
            for (j = 0; j < 17; j += 1) {
                check_value_at(mstr_v8si_get(dst, i, j), mstr_v8si_get(src, j, i), i, j);
            } // for
        } // for

        mstr_v8si_destroy(dst);
        mstr_v8si_destroy(src);
        mops_v8si_destroy(mp);
    }

    // -- 2x9 matrix transpose -- //
    {
        mp = mops_v8si_create();

        src = mstr_v8si_create(2, 9);

        for (i = 0; i < 2; i += 1) {
            for (j = 0; j < 9; j += 1) {
                mstr_v8si_set(src, i, j, i * j);
            } // for
        } // for

        dst = mstr_v8si_create(9, 2);
        mops_v8si_transpose(mp, src, dst);

        for (i = 0; i < 9; i += 1) {
            for (j = 0; j < 2; j += 1) {
                check_value_at(mstr_v8si_get(dst, i, j), mstr_v8si_get(src, j, i), i, j);
            } // for
        } // for

        mstr_v8si_destroy(dst);
        mstr_v8si_destroy(src);
        mops_v8si_destroy(mp);
    }

    // -- 9x2 matrix transpose -- //
    {
        mp = mops_v8si_create();

        src = mstr_v8si_create(9, 2);

        for (i = 0; i < 9; i += 1) {
            for (j = 0; j < 2; j += 1) {
                mstr_v8si_set(src, i, j, i * j);
            } // for
        } // for

        dst = mstr_v8si_create(2, 9);
        mops_v8si_transpose(mp, src, dst);

        for (i = 0; i < 2; i += 1) {
            for (j = 0; j < 9; j += 1) {
                check_value_at(mstr_v8si_get(dst, i, j), mstr_v8si_get(src, j, i), i, j);
            } // for
        } // for

        mstr_v8si_destroy(dst);
        mstr_v8si_destroy(src);
        mops_v8si_destroy(mp);
    }

    // -- 17x33 matrix transpose -- //
    {
        mp = mops_v8si_create();

        src = mstr_v8si_create(17, 33);

        for (i = 0; i < 17; i += 1) {
            for (j = 0; j < 33; j += 1) {
                mstr_v8si_set(src, i, j, i * j);
            } // for
        } // for

        dst = mstr_v8si_create(33, 17);
        mops_v8si_transpose(mp, src, dst);

        for (i = 0; i < 33; i += 1) {
            for (j = 0; j < 17; j += 1) {
                check_value_at(mstr_v8si_get(dst, i, j), mstr_v8si_get(src, j, i), i, j);
            } // for
        } // for

        mstr_v8si_destroy(dst);
        mstr_v8si_destroy(src);
        mops_v8si_destroy(mp);
    }
}
